<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Python 进阶笔记 | 生信技术</title><meta name="author" content="李星泽,lixingzee@gmail.com"><meta name="copyright" content="李星泽"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="面向对象编程 一、什么是面向对象编程  程序设计的范式 抽象并建立对象模型 程序是不同对象相互调用的逻辑  二、Python类的定义与实例化 在Python中，通过class关键字定义一个类，比如我们需要定义一个人的类。按照 Python 的编程习惯，类名以大写字母开头。因此可以这样定义： 1class Person:  pass 注意，在这个Person类的定义里面，并没有继承任何类，除了这样定">
<meta property="og:type" content="article">
<meta property="og:title" content="Python 进阶笔记">
<meta property="og:url" content="http://lxz9.com/2022/05/20/python_advanced/index.html">
<meta property="og:site_name" content="生信技术">
<meta property="og:description" content="面向对象编程 一、什么是面向对象编程  程序设计的范式 抽象并建立对象模型 程序是不同对象相互调用的逻辑  二、Python类的定义与实例化 在Python中，通过class关键字定义一个类，比如我们需要定义一个人的类。按照 Python 的编程习惯，类名以大写字母开头。因此可以这样定义： 1class Person:  pass 注意，在这个Person类的定义里面，并没有继承任何类，除了这样定">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s1.ax1x.com/2022/05/26/XZa1kq.png">
<meta property="article:published_time" content="2022-05-20T14:19:09.000Z">
<meta property="article:modified_time" content="2022-05-26T15:00:17.000Z">
<meta property="article:author" content="李星泽">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s1.ax1x.com/2022/05/26/XZa1kq.png"><link rel="shortcut icon" href="https://z3.ax1x.com/2021/02/09/yawIzV.png"><link rel="canonical" href="http://lxz9.com/2022/05/20/python_advanced/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?72a556f842c8990127f397d4e0c54f2c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-QRG4NL4207"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-QRG4NL4207');
</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'mediumZoom',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}

// https://stackoverflow.com/questions/16839698/jquery-getscript-alternative-in-native-javascript
const getScript = url => new Promise((resolve, reject) => {
  const script = document.createElement('script')
  script.src = url
  script.async = true
  script.onerror = reject
  script.onload = script.onreadystatechange = function() {
    const loadState = this.readyState
    if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
    script.onload = script.onreadystatechange = null
    resolve()
  }
  document.head.appendChild(script)
})</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-26 23:00:17'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"  media="defer" onload="this.media='all'"><meting-js server='tencent' type='playlist' id='2134037073' fixed='true'></meting-js><style>#article-container.post-content h1:before, h2:before, h3:before, h4:before, h5:before, h6:before { -webkit-animation: avatar_turn_around 1s linear infinite; -moz-animation: avatar_turn_around 1s linear infinite; -o-animation: avatar_turn_around 1s linear infinite; -ms-animation: avatar_turn_around 1s linear infinite; animation: avatar_turn_around 1s linear infinite; }</style><link rel="stylesheet" href="/css/iconfont.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/lxz9.css"><link rel="stylesheet" href="/css/icon.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="生信技术" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://z3.ax1x.com/2021/03/10/6JSyoq.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">55</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/map/"><i class="fa-fw fas fa-heart"></i><span> 地图</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2022/05/26/XZa1kq.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">生信技术</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> 照片</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/map/"><i class="fa-fw fas fa-heart"></i><span> 地图</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Python 进阶笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-20T14:19:09.000Z" title="发表于 2022-05-20 22:19:09">2022-05-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-26T15:00:17.000Z" title="更新于 2022-05-26 23:00:17">2022-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Python/">Python</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">19.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>73分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="面向对象编程">面向对象编程</h1>
<h2 id="一、什么是面向对象编程">一、什么是面向对象编程</h2>
<ul>
<li>程序设计的范式</li>
<li>抽象并建立对象模型</li>
<li>程序是不同对象相互调用的逻辑</li>
</ul>
<h2 id="二、Python类的定义与实例化">二、Python类的定义与实例化</h2>
<p>在Python中，通过<code>class</code>关键字定义一个类，比如我们需要定义一个人的类。按照 Python 的编程习惯，类名以大写字母开头。因此可以这样定义：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span>  <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意，在这个<code>Person</code>类的定义里面，并没有继承任何类，除了这样定义以外，还可以有以下两种定义方式。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>():</span> <span class="keyword">pass</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span>  <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>这三种情况有什么区别呢？在Python3中，是没有区别的，但是在Python2中，则有一定的区别。</p>
<p>在Python2中，对于第一种定义的方法，<code>Person</code>类只有有限的几个内建函数<code>'__doc__', '__module__', 'name'</code>，而对于第二种、第三种定义的方法，则会继承Python object对象的更多的内建函数，可以更便捷的操作对象。这是Python2版本的差异。在Python3中，我们只需要知道这三种方式都可以定义一个类即可。</p>
<p>定义了类之后，就可以对类进行实例化了，实例化是指，把抽象的类，赋予实物的过程。比如，定义好Person这个类后，就可以实例化多个Person出来了。 创建实例使用<code>类名+()</code>，类似函数调用的形式创建：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span>  <span class="keyword">pass</span> </span><br><span class="line">xiaohong = Person()</span><br><span class="line">xiaoming = Person()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务">任务</h3>
<p>请练习定义一个动物类，并创建出两个实例dog, cat，打印实例，再比较两个实例是否相等。</p>
<p>要打印实例，直接使用print语句；</p>
<p>要比较两个实例是否相等，用==操作符。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span>  </span><br><span class="line">	<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">dog = Animal()</span><br><span class="line">cat = Animal()</span><br><span class="line">print(dog) print(cat) print(dog == cat)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="三、实例属性的定义">三、实例属性的定义</h2>
<p>虽然前面我们已经通过Person类创建出xiaoming、xiaohong等实例，但是这些实例看上去并没有任何区别。在现实世界中，一个人拥有名字、性别、年龄等等的信息，在Python中，可以通过以下的方式赋予实例这些属性，并且把这些属性打印出来。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">xiaohong.name = <span class="string">'xiaohong'</span></span><br><span class="line">xiaohong.sex = <span class="string">'girl'</span></span><br><span class="line">xiaohong.age = <span class="number">13</span></span><br><span class="line"></span><br><span class="line">print(xiaohong.name)</span><br><span class="line">print(xiaohong.sex)</span><br><span class="line">print(xiaohong.age)</span><br></pre></td></tr></tbody></table></figure>
<p>除此以外，这些属性也可以和普通变量一样进行运算。比如xiaohong长大了一岁：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xiaohong.age = xiaohong.age + <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-2">任务</h3>
<blockquote>
<p>请定义一个动物类，并创建出两个实例dog, cat，分别赋予不同的名字和年龄并打印出来。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">dog = Animal()</span><br><span class="line">cat = Animal()</span><br><span class="line">dog.name = <span class="string">'wangwang'</span></span><br><span class="line">dog.age = <span class="number">1</span></span><br><span class="line">cat.name = <span class="string">'mimi'</span></span><br><span class="line">cat.age = <span class="number">3</span></span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="四、实例属性的初始化">四、实例属性的初始化</h2>
<p>通过前面的方式定义一个实例的属性非常方便，但也有一些问题。 首先，如果定义属性的过程中使用了不同的属性名字，比如性别，前者使用了<code>sex</code>，后者使用了<code>gender</code>，那对于一个类的不同实例，存储一个信息就用了两个不同的属性，在后面将会难以维护。 其次，名字、性别、年龄等等，都是人的基本信息，在抽象一个类的时候，理应包含这些信息。 在定义 Person 类时，可以为Person类添加一个特殊的<code>__init__()</code>方法，当创建实例时，<code>__init__()</code>方法被自动调用，我们就能在此为每个实例都统一加上以下属性：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, sex, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.sex = sex</span><br><span class="line">        self.age = age</span><br></pre></td></tr></tbody></table></figure>
<p>需要注意的是，<code>__init__()</code> 方法的第一个参数必须是 <code>self</code>（也可以用别的名字，但建议使用习惯用法），后续参数则可以自由指定，和定义函数没有任何区别。 定义类后，就可以相应的实例化对象了，需要注意的是，在实例化的时候，需要提供除<code>self</code>以外的所有参数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xiaoming = Person(<span class="string">'Xiao Ming'</span>, <span class="string">'boy'</span>, <span class="number">13</span>)</span><br><span class="line">xiaohong = Person(<span class="string">'Xiao Hong'</span>, <span class="string">'girl'</span>, <span class="number">14</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>而访问这些属性的方式和之前的一样：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(xiaohong.name)</span><br><span class="line">print(xiaohong.sex)</span><br><span class="line">print(xiaohong.age)</span><br><span class="line"><span class="comment"># 但当访问不存在的属性时，依然会报错</span></span><br><span class="line">print(xiaohong.birth)</span><br></pre></td></tr></tbody></table></figure>
<p>要特别注意的是，初学者定义<code>__init__()</code>方法常常忘记了 self 参数，比如如下的定义：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">name, sex, age</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>这种情况下，如果还是如下实例化，将会报错。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xiaoming = Person(<span class="string">'Xiao Ming'</span>, <span class="string">'boy'</span>, <span class="number">13</span>)</span><br><span class="line">xiaohong = Person(<span class="string">'Xiao Hong'</span>, <span class="string">'girl'</span>, <span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: __init__() takes <span class="number">3</span> positional arguments but <span class="number">4</span> were given</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-3">任务</h3>
<blockquote>
<p>请定义一个动物类，抽象出名字、年龄两个属性，并实例化两个实例<code>dog</code>, <code>cat</code>。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>)</span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>)</span><br><span class="line">print(dog.name)</span><br><span class="line">print(dog.age)</span><br><span class="line">print(cat.name)</span><br><span class="line">print(cat.age)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="五、类属性">五、类属性</h2>
<p>类和实例对象是有区别的，类是抽象，是模板，而实例则是根据类创建的对象，比如类：动物，只是一个抽象，并没有动物的详细信息，而猫、狗等，则是具体的动物，是类的对象。</p>
<p>在前面，实例对象绑定的属性只属于这个实例，绑定在一个实例上的属性不会影响其它实例；同样的，类也可以绑定属性，但是类的属性不属于任何一个对象，而是属于这个类。如果在类上绑定一个属性，则所有实例都可以访问类的属性，并且，所有实例访问的类属性都是同一个！也就是说，实例属性每个实例各自拥有，互相独立，而类属性有且只有一份。</p>
<p>定义类属性可以直接在 class 中定义，比如在前面的Animal类中，加入地域的类属性：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    localtion = <span class="string">'Asia'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br></pre></td></tr></tbody></table></figure>
<p>在上面的代码中，localtion就是属于Animal这个类的类属性，此后，通过Animal()实例化的所有对象，都可以访问到localtion，并且得到唯一的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>)</span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>)</span><br><span class="line">print(dog.localtion) <span class="comment"># ==&gt; Asia</span></span><br><span class="line">print(cat.localtion) <span class="comment"># ==&gt; Asia</span></span><br><span class="line"><span class="comment"># 类属性，也可以通过类名直接访问</span></span><br><span class="line">print(Animal.localtion) <span class="comment"># ==&gt; Asia</span></span><br></pre></td></tr></tbody></table></figure>
<p>类属性也是可以动态添加和修改的，需要注意的是，因为类属性只有一份，所以改变了，所有实例可以访问到的类属性都会变更：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Animal.localtion = <span class="string">'Africa'</span></span><br><span class="line">print(cat.localtion) <span class="comment"># ==&gt;Africa</span></span><br><span class="line">print(dog.localtion) <span class="comment"># ==&gt;Africa</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-4">任务</h3>
<blockquote>
<p>请给 Animal类添加一个类属性 count，每创建一个实例，count 属性就加 1，这样就可以统计出一共创建了多少个 Animal的实例。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        Animal.count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>)</span><br><span class="line">print(Animal.count)</span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>)</span><br><span class="line">print(Animal.count)</span><br><span class="line">pig = Animal(<span class="string">'panpan'</span>, <span class="number">1</span>)</span><br><span class="line">print(Animal.count)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="六、类属性和实例属性的优先级">六、类属性和实例属性的优先级</h2>
<p>可以看到，属性可以分为类属性和实例属性，那么问题就来了，如果类属性和实例属性名字相同时，会怎么样，这就涉及Python中类属性和实例属性的优先级的问题了。</p>
<p>我们可以做一个实验，在前面类定义的基础上，在实例属性中，也初始化一个localtion的属性。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    localtion = <span class="string">'Asia'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, localtion</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.localtion = localtion</span><br></pre></td></tr></tbody></table></figure>
<p>接着我们初始化两个实例，并把localtion打印出来。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>, <span class="string">'GuangDong'</span>)</span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>, <span class="string">'ChongQing'</span>)</span><br><span class="line">print(dog.localtion) <span class="comment"># ==&gt; GuangDong</span></span><br><span class="line">print(cat.localtion) <span class="comment"># ==&gt; ChongQing</span></span><br><span class="line">print(Animal.localtion) <span class="comment"># ==&gt; Asia</span></span><br></pre></td></tr></tbody></table></figure>
<p>可见，在类属性和实例属性同时存在的情况下，实例属性的优先级是要高于类属性的，在操作实例的时候，优先是操作实例的属性。</p>
<p>另外，当实例没有和类同名的时候，通过实例对象，依然可以访问到类属性。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    localtion = <span class="string">'Asia'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>)</span><br><span class="line">print(cat.localtion) <span class="comment"># ==&gt; Asia</span></span><br></pre></td></tr></tbody></table></figure>
<p>那通过实例，可不可以修改类属性呢？我们来尝试一下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat.localtion = <span class="string">'Africa'</span></span><br><span class="line">print(Animal.localtion) <span class="comment"># ==&gt; Asia</span></span><br></pre></td></tr></tbody></table></figure>
<p>这里依然打印了Asia，可见通过实例是无法修改类的属性的，事实上，通过实例方法修改类属性，只是给实例绑定了一个对应的实例属性：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 新增的实例属性</span></span><br><span class="line">print(cat.localtion) <span class="comment"># ==&gt; Africa</span></span><br></pre></td></tr></tbody></table></figure>
<p>因此，需要特别注意，尽量不要通过实例来修改类属性，否则很容易引发意想不到的错误。</p>
<h3 id="任务-5">任务</h3>
<blockquote>
<p>请把上节的 Animal类属性 count 改为 __count，再试试能否从实例和类访问该属性。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
把count改为私有__count，这样实例变量在外部无法修改__count
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __count = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        Animal.__count = Animal.__count + <span class="number">1</span></span><br><span class="line">        self.name = name</span><br><span class="line">        print(Animal.__count)</span><br><span class="line"></span><br><span class="line">p1 = Animal(<span class="string">'Cat'</span>)</span><br><span class="line">p2 = Animal(<span class="string">'Dog'</span>)</span><br><span class="line"></span><br><span class="line">print(Animal.__count)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="七、访问限制">七、访问限制</h2>
<p>并不是所有的属性都可以被外部访问的，这种不能被外部访问的属性称为私有属性。私有属性是以双下划线<code>'__'</code>开头的属性。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类私有属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __localtion = <span class="string">'Asia'</span></span><br><span class="line"></span><br><span class="line">print(Animal.__localtion)</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="built_in">type</span> <span class="built_in">object</span> <span class="string">'Animal'</span> has no attribute <span class="string">'__localtion'</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 实例私有属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, localtion</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.__localtion = localtion</span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>, <span class="string">'GuangDong'</span>)</span><br><span class="line">print(dog.name) <span class="comment"># ==&gt; wangwang</span></span><br><span class="line">print(dog.age) <span class="comment"># ==&gt; 1</span></span><br><span class="line">print(dog.__localtion)</span><br><span class="line"></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">'Animal'</span> <span class="built_in">object</span> has no attribute <span class="string">'__localtion'</span></span><br></pre></td></tr></tbody></table></figure>
<p>在外部访问私有属性将会抛出异常，提示没有这个属性。 虽然私有属性无法从外部访问，但是，从类的内部是可以访问的。私有属性是为了保护类或实例属性不被外部污染而设计的。</p>
<h3 id="任务-6">任务</h3>
<blockquote>
<p>请给Animal类的__init__方法中添加name和age参数，并把age绑定到__age属性上，看看外部是否能访问到。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.__age = age</span><br><span class="line"></span><br><span class="line">cat = Animal(<span class="string">'Kitty'</span>, <span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line">print(cat.name)</span><br><span class="line">print(cat.__age)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="八、定义实例方法">八、定义实例方法</h2>
<p>上面提到，私有属性没有办法从外部访问，只能在类的内部操作；那如果外部需要操作私有属性怎么办？这个时候可以通过定义类或者实例的方法来操作私有属性，本节课先来介绍实例方法。</p>
<p>实例的方法指的就是在类中定义的函数，实例方法的第一个参数永远都是self，self是一个引用，指向调用该方法的实例对象本身，除此以外，其他参数和普通函数是完全一样的。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br></pre></td></tr></tbody></table></figure>
<p>在上面的定义，name是实例的私有属性，从外部是无法访问的，而get_name(self) 就是一个实例方法，在实例方法里面是可以操作私有属性的，注意，它的第一个参数是self。</p>
<p>另外，<code>__init__(self, name)</code>其实也可看做是一个特殊的实例方法。</p>
<p>通过定义get_name(self)方法，在外部就可以通过这个方法访问私有属性了。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p = Person(<span class="string">'Alice'</span>)</span><br><span class="line">print(p.get_name()) <span class="comment"># ==&gt; Alice</span></span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>注意，在外部调用实例方法时，是不需要显式传递self参数的。</p>
</blockquote>
<p>另外，通过定义实例方法来操作私有属性的这种方法是推荐的，这种数据封装的形式除了能保护内部数据一致性外，还可以简化外部调用的难度。 当然，实例方法并不仅仅是为私有属性服务的，我们可以把和类的实例有关的操作都抽象成实例方法，比如：打印实例的详细信息等等。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, localtion</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.localtion = localtion</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_info</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'name = {}, age = {}, localtion = {}'</span>.<span class="built_in">format</span>(self.name, self.age, self.localtion)</span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>, <span class="string">'GuangDong'</span>)</span><br><span class="line">print(dog.get_info())</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-7">任务</h3>
<blockquote>
<p>把Animal类的age、name、localtion定义成私有属性，并定义对应的方法修改和获取他们的值。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age, localtion</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line">        self.__age = age</span><br><span class="line">        self.__localtion = localtion</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_name</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_age</span>(<span class="params">self, age</span>):</span></span><br><span class="line">        self.__age = age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_age</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__age</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_localtion</span>(<span class="params">self, localtion</span>):</span></span><br><span class="line">        self.__localtion =localtion</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_localtion</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__localtion</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="九、定义类方法">九、定义类方法</h2>
<p>在上面，为了操作实例对象的私有属性，我们定义了实例方法；同样的，如果需要需要操作类的私有属性，则应该定义类的方法。</p>
<p>默认的，在class中定义的全部是实例方法，实例方法第一个参数 self 是实例本身。</p>
<p>要在class中定义类方法，需要这么写：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __localtion = <span class="string">'Asia'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_localtion</span>(<span class="params">cls, localtion</span>):</span></span><br><span class="line">        cls.__localtion = localtion</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_localtion</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.__localtion</span><br><span class="line"></span><br><span class="line">print(Animal.get_localtion()) <span class="comment"># ==&gt; Asia</span></span><br><span class="line">Animal.set_localtion(<span class="string">'Afica'</span>)</span><br><span class="line">print(Animal.get_localtion()) <span class="comment"># ==&gt; Africa</span></span><br></pre></td></tr></tbody></table></figure>
<p>和实例方法不同的是，这里有两点需要特别注意：</p>
<ol>
<li>类方法需要使用@classmethod来标记为类方法，否则定义的还是实例方法</li>
<li>类方法的第一个参数将传入类本身，通常将参数名命名为 cls，上面的 cls.__localtion 实际上相当于Animal.__localtion。</li>
</ol>
<p>因为是在类上调用，而非实例上调用，因此类方法无法获得任何实例变量，只能获得类的引用。</p>
<h3 id="任务-8">任务</h3>
<blockquote>
<p>如果将类属性count改为私有属性__count，则外部无法获取__count，但是可以通过一个类方法获取，请编写类方法获得__count值。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<p>注意类方法需要添加 <code>@classmethod</code></p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __localtion = <span class="string">'Asia'</span></span><br><span class="line">    __count = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        Animal.__count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_count</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">return</span> cls.__count</span><br><span class="line"></span><br><span class="line">dog = Animal(<span class="string">'wangwang'</span>, <span class="number">1</span>)</span><br><span class="line">cat = Animal(<span class="string">'mimi'</span>, <span class="number">3</span>)</span><br><span class="line">pig = Animal(<span class="string">'panpan'</span>, <span class="number">1</span>)</span><br><span class="line">count = Animal.get_count()</span><br><span class="line">print(count)</span><br></pre></td></tr></tbody></table></figure>
</details>
<hr>
<h1 id="Python进阶教程笔记（二）类的继承、多态">Python进阶教程笔记（二）类的继承、多态</h1>
<p>2020-10-302020-10-30 11:42:23阅读 1660</p>
<h2 id="一、什么是继承">一、什么是继承</h2>
<ul>
<li>程序设计的范式</li>
<li>抽象并建立对象模型</li>
<li>程序是不同对象相互调用的逻辑</li>
</ul>
<h2 id="二、继承的优点">二、继承的优点</h2>
<ul>
<li>新类不需要重头编写</li>
<li>继承父类所有的属性、功能</li>
<li>子类只需要实现缺少的新功能</li>
</ul>
<h2 id="三、继承类">三、继承类</h2>
<p>对人类的抽象可以定义为Person类，而学生、老师等，也都是人类，所以，在Python当中，如果定义学生Student的类，可以继承Person类。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br></pre></td></tr></tbody></table></figure>
<p>接着定义Student类，在定义Student类的时候，由于继承了Person类，所以Student类自动拥有name、gender属性，因此，在定义Student类的时候，只需要把额外的属性加上即可。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line">student = Student(<span class="string">'Alice'</span>, <span class="string">'girl'</span>, <span class="number">100</span>)</span><br><span class="line">print(student.name) <span class="comment"># ==&gt; Alice</span></span><br><span class="line">print(student.gender) <span class="comment"># ==&gt; girl</span></span><br><span class="line">print(student.score) <span class="comment"># ==&gt; 100</span></span><br></pre></td></tr></tbody></table></figure>
<p>在定义继承类的时候，有几点是需要注意的：</p>
<ol>
<li>class Student()定义的时候，需要在括号内写明继承的类Person</li>
<li>在<code>__init__()</code>方法，需要调用<code>super(Student, self).__init__(name, gender)</code>，来初始化从父类继承过来的属性</li>
</ol>
<h3 id="任务-9">任务</h3>
<blockquote>
<p>请参考Student类，编写Teacher类，老师拥有任教某个科目的属性。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, course</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Teacher,self).__init__(name,gender)</span><br><span class="line">        self.course = course</span><br><span class="line"></span><br><span class="line">teacher = Teacher(<span class="string">'Alice'</span>, <span class="string">'Female'</span>, <span class="string">'English'</span>)</span><br><span class="line">print(teacher.name)</span><br><span class="line">print(teacher.gender)</span><br><span class="line">print(teacher.course)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="四、判断类型">四、判断类型</h2>
<p>随着我们学习步伐的前进，我们的程序会出现越来越多的类型，有我们自己定义的类，也有Python自有的str、list、dict等，他们的本质都是都是Python中的一种数据类型，这时有必要去判断数据的类型，通过函数isinstance()可以判断一个变量的类型。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, course</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Teacher, self).__init__(name, gender)</span><br><span class="line">        self.course = course</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Tim'</span>, <span class="string">'Male'</span>)</span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">88</span>)</span><br><span class="line">t = Teacher(<span class="string">'Alice'</span>, <span class="string">'Female'</span>, <span class="string">'English'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>当我们拿到变量 p、s、t 时，可以使用 isinstance 判断类型：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(p, Person)</span><br><span class="line"><span class="literal">True</span> <span class="comment"># p是Person类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(p, Student)</span><br><span class="line"><span class="literal">False</span> <span class="comment"># p不是Student类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(p, Teacher)</span><br><span class="line"><span class="literal">False</span> <span class="comment"># p不是Teacher类型</span></span><br></pre></td></tr></tbody></table></figure>
<p>这说明在继承链上，一个父类的实例不能是子类类型，因为子类比父类多了一些属性和方法。 我们再考察 s：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(s, Person)</span><br><span class="line"><span class="literal">True</span> <span class="comment"># s是Person类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(s, Student)</span><br><span class="line"><span class="literal">True</span> <span class="comment"># s是Student类型</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">isinstance</span>(s, Teacher)</span><br><span class="line"><span class="literal">False</span> <span class="comment"># s不是Teacher类型</span></span><br></pre></td></tr></tbody></table></figure>
<p>s 是Student类型，不是Teacher类型，这很容易理解。但是，s 也是Person类型，因为Student继承自Person，虽然它比Person多了一些属性和方法，但是，把 s 看成Person的实例也是可以的。</p>
<p>这说明在一条继承链上，一个实例可以看成它本身的类型，也可以看成它父类的类型。</p>
<p>isinstance也可以用于Python自有数据类型的判断。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'this is a string.'</span></span><br><span class="line">n = <span class="number">10</span></span><br><span class="line"><span class="built_in">isinstance</span>(s, <span class="built_in">int</span>) <span class="comment"># ==&gt; False</span></span><br><span class="line"><span class="built_in">isinstance</span>(n, <span class="built_in">str</span>) <span class="comment"># ==&gt; False</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-10">任务</h3>
<blockquote>
<p>请根据继承链的类型转换，依次思考 t 是否是 Person，Student，Teacher，object 类型，并使用isinstance()判断来验证您的答案。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<ol>
<li>
<p>使用isinstance()来进行判断</p>
</li>
<li>
<p>使用print()函数打印输出判断结果</p>
</li>
</ol>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, course</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Teacher, self).__init__(name, gender)</span><br><span class="line">        self.course = course</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Tim'</span>, <span class="string">'Male'</span>)</span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">88</span>)</span><br><span class="line">t = Teacher(<span class="string">'Alice'</span>, <span class="string">'Female'</span>, <span class="string">'English'</span>)</span><br><span class="line"><span class="built_in">isinstance</span>(t, Person)</span><br><span class="line"><span class="built_in">isinstance</span>(t, Student)</span><br><span class="line"><span class="built_in">isinstance</span>(t, Teacher)</span><br><span class="line"><span class="built_in">isinstance</span>(t, <span class="built_in">object</span>)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="五、多态">五、多态</h2>
<p>类具有继承关系，并且子类类型可以向上转型看做父类类型，如果我们从 Person 派生出 Student和Teacher ，并都写了一个who() 方法：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">who</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am a Person, my name is %s'</span> % self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">who</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am a Student, my name is %s'</span> % self.name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, course</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Teacher, self).__init__(name, gender)</span><br><span class="line">        self.course = course</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">who</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am a Teacher, my name is %s'</span> % self.name</span><br></pre></td></tr></tbody></table></figure>
<p>接着，我们分别把不同类型的who()函数结果打印出来：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p = Person(<span class="string">'Tim'</span>, <span class="string">'Male'</span>)</span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">88</span>)</span><br><span class="line">t = Teacher(<span class="string">'Alice'</span>, <span class="string">'Female'</span>, <span class="string">'English'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>运行结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I am a Person, my name <span class="keyword">is</span> Tim</span><br><span class="line">I am a Student, my name <span class="keyword">is</span> Bob</span><br><span class="line">I am a Teacher, my name <span class="keyword">is</span> Alice</span><br></pre></td></tr></tbody></table></figure>
<p>这种行为称为多态。从定义上来讲，Student和Teacher都拥有来自父类Person继承的who()方法，以及自己定义的who()方法。但是在实际调用的时候，会首先查找自身的定义，如果自身有定义，则优先使用自己定义的函数；如果没有定义，则顺着继承链向上找。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Boss</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender,company</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Boss, self).__init__(name, gender)</span><br><span class="line">        self.company = company</span><br><span class="line"></span><br><span class="line">b = Boss(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="string">'Alibaba'</span>)</span><br><span class="line">b.who() <span class="comment"># ==&gt; I am a Person, my name is Bob</span></span><br></pre></td></tr></tbody></table></figure>
<p>在Boss的定义类，没有定义who方法，所以会顺着继承链向上找到父类的who方法并且调用。</p>
<h3 id="Python中的多重继承">Python中的多重继承</h3>
<p>除了从一个父类继承外，Python允许从多个父类继承，称为多重继承。多重继承和单继承没有特别大的差异，只是在括号内加入多个需要继承的类的名字即可。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        <span class="built_in">print</span> (<span class="string">'init A...'</span>)</span><br><span class="line">        self.a = a</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(B, self).__init__(a)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">'init B...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">A</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(C, self).__init__(a)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">'init C...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span>(<span class="params">B, C</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(D, self).__init__(a)</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">'init D...'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>多重继承的继承链就不是一棵树了，它像这样：</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1217896/lty3oeb5zi.png?imageView2/2/w/1620" alt=""></p>
<p>从上图可知，A类被继承了连词，那么A的<code>__init__()</code>方法，是否会被调用两次呢？</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">d = D(<span class="string">'d'</span>)</span><br><span class="line">init A...</span><br><span class="line">init C...</span><br><span class="line">init B...</span><br><span class="line">init D...</span><br></pre></td></tr></tbody></table></figure>
<p>实践证明，在多重继承里，A虽然被继承了两次，但是<code>__init__()</code>的方法只调用一次。</p>
<p>多重继承的目的是从两种继承树中分别选择并继承出子类，以便组合功能使用。</p>
<p>举个例子，Python的网络<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cloud.tencent.com/product/cvm?from=10680">服务器</a>有TCPServer、UDPServer、UnixStreamServer、UnixDatagramServer，而服务器运行模式有 多进程ForkingMixin 和 多线程ThreadingMixin两种。</p>
<p>要创建多进程模式的 TCPServer：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyTCPServer</span>(<span class="params">TCPServer, ForkingMixin</span>)</span></span><br><span class="line"><span class="class">    <span class="title">pass</span></span></span><br></pre></td></tr></tbody></table></figure>
<p>要创建多线程模式的 UDPServer：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyUDPServer</span>(<span class="params">UDPServer, ThreadingMixin</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果没有多重继承，要实现上述所有可能的组合需要 4x2=8 个子类。</p>
<h3 id="任务-11">任务</h3>
<blockquote>
<p>已知类Student、Teacher继承Person类，技能类BasketballMixin、FootballMixin继承SkillMixin类，请通过多重继承，分别定义“会打篮球的学生”和“会踢足球的老师”。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Teacher</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SkillMixin</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasketballMixin</span>(<span class="params">SkillMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">skill</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'basketball'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FootballMixin</span>(<span class="params">SkillMixin</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">skill</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'football'</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BStudent</span>(<span class="params">BasketballMixin, Student</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FTeacher</span>(<span class="params">FootballMixin, Teacher</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">s = BStudent()</span><br><span class="line">print(s.skill())</span><br><span class="line"></span><br><span class="line">t = FTeacher()</span><br><span class="line">print(t.skill())</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="六、获取对象信息">六、获取对象信息</h2>
<p>在前面，我们通过isinstance()方法，可以判断一个对象是否是某个类型，从某种意义上来讲，通过isinstance()方法，我们获取到了一个对象的一些信息，那有没有别的方法可以获取到对象更多的信息呢？ 通过type()函数，可以获得变量的类型。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">1</span></span><br><span class="line">s = <span class="string">'this is a string'</span></span><br><span class="line"><span class="built_in">type</span>(n) <span class="comment"># ==&gt; &lt;class 'int'&gt;</span></span><br><span class="line"><span class="built_in">type</span>(s) <span class="comment"># ==&gt; &lt;class 'str'&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Alice'</span>, <span class="string">'Female'</span>)</span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">100</span>)</span><br><span class="line"><span class="built_in">type</span>(p) <span class="comment"># ==&gt; &lt;class '__main__.Person'&gt;</span></span><br><span class="line"><span class="built_in">type</span>(s) <span class="comment"># ==&gt; &lt;class '__main__.Student'&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>通过dir()方法，可以获取变量的所有属性：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>n = <span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(n)</span><br><span class="line">[<span class="string">'__abs__'</span>, <span class="string">'__add__'</span>, <span class="string">'__and__'</span>, <span class="string">'__bool__'</span>, <span class="string">'__ceil__'</span>, <span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__divmod__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__float__'</span>, ...]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s = <span class="string">'this is a string'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(s)</span><br><span class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__getnewargs__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__mod__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, ...]</span><br></pre></td></tr></tbody></table></figure>
<p>在dir列出的属性中，有很多是以下划线开头和结尾的，这些都是特殊的方法，称为内建方法，在后面，我们还会学习这些方法。 而对于自定义对象：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">who</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'I am a Person, my name is {}'</span>.<span class="built_in">format</span>(self.name)</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Alice'</span>, <span class="string">'Female'</span>)</span><br><span class="line"><span class="built_in">dir</span>(p)</span><br><span class="line"></span><br><span class="line">[<span class="string">'__class__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__dict__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__le__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__module__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'__weakref__'</span>, <span class="string">'gender'</span>, <span class="string">'name'</span>, <span class="string">'who'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>对于实例变量，dir()返回所有实例属性，包括<code>__class__</code>这类有特殊意义的属性。注意到方法who也是p的一个属性。</p>
<p>dir()返回的属性是字符串列表，如果已知一个属性名称，要获取或者设置对象的属性，就需要用 getattr() 和 setattr( )函数了。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(p, <span class="string">'name'</span>) <span class="comment"># 获取name属性</span></span><br><span class="line"><span class="string">'Alice'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">setattr</span>(p, <span class="string">'name'</span>, <span class="string">'Adam'</span>) <span class="comment"># 设置新的name属性</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>s.name</span><br><span class="line"><span class="string">'Adam'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(s, <span class="string">'age'</span>) <span class="comment"># 获取age属性，但是属性不存在，报错：</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">AttributeError: <span class="string">'Person'</span> <span class="built_in">object</span> has no attribute <span class="string">'age'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">getattr</span>(s, <span class="string">'age'</span>, <span class="number">20</span>) <span class="comment"># 获取age属性，如果属性不存在，就返回默认值20：</span></span><br><span class="line"><span class="number">20</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-12">任务</h3>
<blockquote>
<p>对于Person类的定义：</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br></pre></td></tr></tbody></table></figure>
<p>希望除了<code>name</code>和<code>gender</code>外，可以提供任意额外的关键字参数，并绑定到实例，请修改 Person 的<code>__init__()</code>定义，完成该功能。</p>
<details><summary> 参考答案 </summary>
<br>
提示：结合在入门课程学习的向函数传递任意关键字参数的方法以及刚刚学习的setattr()方法。
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, **kw</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> kw.items():</span><br><span class="line">            <span class="built_in">setattr</span>(self, k, v)</span><br><span class="line"></span><br><span class="line">p = Person(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, age=<span class="number">18</span>, course=<span class="string">'Python'</span>)</span><br><span class="line">print(p.age)</span><br><span class="line">print(p.course)</span><br></pre></td></tr></tbody></table></figure>
</details>
<hr>
<h1 id="Python进阶教程笔记（三）类的特殊方法">Python进阶教程笔记（三）类的特殊方法</h1>
<h2 id="一、什么是特殊方法">一、什么是特殊方法</h2>
<ul>
<li>双下划线开头</li>
<li>双下划线结尾</li>
<li>每个Python对象都拥有特殊方法</li>
<li>常见特殊方法</li>
</ul>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__str__(), __add__(), __sub__(), __mul__(), __truediv__(), __len__(),</span><br><span class="line">__new__(), __init__(), __del__(), __repr__(), __bytes__(), __format__(),</span><br><span class="line">__lt__(), __le__(), __eq__(), __ne__(), __gt__(), __ge__(), __hash__(),</span><br><span class="line">__bool__(), __dir__(), __set__(), __call__(), __slots__(), ...</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h2 id="二、类的-str-和-repr-方法">二、类的__str__ 和 __repr__方法</h2>
<p>对于Python的内建对象，比如int、dict、list等，通过str()方法，可以把这些对象转换为字符串对象输出。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">12</span></span><br><span class="line"><span class="built_in">str</span>(num) <span class="comment"># ==&gt; '12'</span></span><br><span class="line">d = {<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>}</span><br><span class="line"><span class="built_in">str</span>(d) <span class="comment"># ==&gt; '{1: 1, 2: 2}'</span></span><br><span class="line">l = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"><span class="built_in">str</span>(l) <span class="comment"># ==&gt; '[1, 2, 3, 4, 5]'</span></span><br></pre></td></tr></tbody></table></figure>
<p>对于自定义对象，通过str()方法，同样可以得到对象所对应的字符串结果，只不过结果会有些难理解。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">bob = Person()</span><br><span class="line"><span class="built_in">str</span>(bob) <span class="comment"># ==&gt; '&lt;__main__.Person object at 0x7fc77b859c50&gt;'</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>&lt;__main__.Person object at 0x7fc77b859c50&gt;</code>这个结果其实是Animal的实例cat在内存中的地址，这是相当难以理解的，不过引发思考的是，通过str()打印的数据，是怎么来的呢？</p>
<p>这其实是对象的内建方法<code>__str__</code>返回的。 通过dir()方法，我们可以把对象的所有方法打印出来。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(<span class="built_in">list</span>)</span><br><span class="line">[<span class="string">'__add__'</span>, <span class="string">'__class__'</span>, <span class="string">'__contains__'</span>, <span class="string">'__delattr__'</span>, <span class="string">'__delitem__'</span>, <span class="string">'__dir__'</span>, <span class="string">'__doc__'</span>, <span class="string">'__eq__'</span>, <span class="string">'__format__'</span>, <span class="string">'__ge__'</span>, <span class="string">'__getattribute__'</span>, <span class="string">'__getitem__'</span>, <span class="string">'__gt__'</span>, <span class="string">'__hash__'</span>, <span class="string">'__iadd__'</span>, <span class="string">'__imul__'</span>, <span class="string">'__init__'</span>, <span class="string">'__init_subclass__'</span>, <span class="string">'__iter__'</span>, <span class="string">'__le__'</span>, <span class="string">'__len__'</span>, <span class="string">'__lt__'</span>, <span class="string">'__mul__'</span>, <span class="string">'__ne__'</span>, <span class="string">'__new__'</span>, <span class="string">'__reduce__'</span>, <span class="string">'__reduce_ex__'</span>, <span class="string">'__repr__'</span>, <span class="string">'__reversed__'</span>, <span class="string">'__rmul__'</span>, <span class="string">'__setattr__'</span>, <span class="string">'__setitem__'</span>, <span class="string">'__sizeof__'</span>, <span class="string">'__str__'</span>, <span class="string">'__subclasshook__'</span>, <span class="string">'append'</span>, <span class="string">'clear'</span>, <span class="string">'copy'</span>, <span class="string">'count'</span>, <span class="string">'extend'</span>, <span class="string">'index'</span>, <span class="string">'insert'</span>, <span class="string">'pop'</span>, <span class="string">'remove'</span>, <span class="string">'reverse'</span>, <span class="string">'sort'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到，int、dict、list等的内建对象都实现了自己的<code>__str__()</code>方法，可以把相应的字符串返回，如果我们的类也想把容易理解的字符串输出的话，那么我们也需要实现类的<code>__str__()</code>方法。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'name: {}, gender: {}'</span>.<span class="built_in">format</span>(self.name, self.gender)</span><br><span class="line"></span><br><span class="line">bob = Person(<span class="string">'Bob'</span>, <span class="string">'Male'</span>)</span><br><span class="line"><span class="built_in">str</span>(bob) <span class="comment"># ==&gt; 'name: Bob, gender: Male'</span></span><br></pre></td></tr></tbody></table></figure>
<p>但是，对于直接在终端输入变量bob，得到的依然是这样结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>bob</span><br><span class="line">&lt;__main__.Person <span class="built_in">object</span> at <span class="number">0x7fc77b859cc0</span>&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>而对于int、list等的对象，直接输入变量也可得到可读的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = <span class="number">12</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">str</span>(num)</span><br><span class="line"><span class="string">'12'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d = {<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>}</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>d</span><br><span class="line">{<span class="number">1</span>: <span class="number">1</span>, <span class="number">2</span>: <span class="number">2</span>}</span><br></pre></td></tr></tbody></table></figure>
<p>__str__()函数似乎没有在自定义类Person中生效，这是为什么呢？</p>
<p>这是因为 Python 定义了<code>__str()__</code>和<code>__repr__()</code>两种方法，<code>__str()__</code>用于显示给用户，而<code>__repr__()</code>用于显示给开发人员，当使用str()时，实际调用的是<code>__str__()</code>方法，而直接输入变量，调用的是<code>__repr__()</code>方法。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'name: {}, gender: {}'</span>.<span class="built_in">format</span>(self.name, self.gender)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'name: {}, gender: {}'</span>.<span class="built_in">format</span>(self.name, self.gender)</span><br><span class="line"></span><br><span class="line">bob = Person(<span class="string">'Bob'</span>, <span class="string">'Male'</span>)</span><br><span class="line"><span class="built_in">str</span>(bob) <span class="comment"># ==&gt; 'name: Bob, gender: Male'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>bob</span><br><span class="line"><span class="string">'name: Bob, gender: Male'</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-13">任务</h3>
<blockquote>
<p>请给Student 类定义__str__和__repr__方法，使得能打印出’Student: name, gender, score’。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Student, self).__init__(name, gender)</span><br><span class="line">        self.score = score</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Student: {}, {}, {}'</span>.<span class="built_in">format</span>(self.name, self.gender, self.score)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'Student: {}, {}, {}'</span>.<span class="built_in">format</span>(self.name, self.gender, self.score)</span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">88</span>)</span><br><span class="line">print(s)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="三、类的-len-方法">三、类的__len__方法</h2>
<p>对于列表List或者元组Tuple，通过内建方法len()，可以得出列表或者元组中元素的个数。如果一个类表现得像一个list，想使用len()函数来获取元素个数时，则需要实现len()方法。</p>
<p>比如我们实现一个班级Class的类，初始化把班级的同学名字列表传进去，希望len()函数可以返回班级同学的数量时，可以这样实现。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, students</span>):</span></span><br><span class="line">        self.students = students</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">len</span>(self.students)</span><br><span class="line"></span><br><span class="line">students = [<span class="string">'Alice'</span>, <span class="string">'Bob'</span>, <span class="string">'Candy'</span>]</span><br><span class="line">class_ = Class(students)</span><br><span class="line"><span class="built_in">len</span>(class_) <span class="comment"># ==&gt; 3</span></span><br></pre></td></tr></tbody></table></figure>
<p>通过自定义<code>__len__()</code>方法，可以让<code>len()</code>函数返回相关的结果，如果没有定义<code>__len__()</code>方法的类使用<code>len()</code>函数获取长度时，将会引起异常。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Class</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, students</span>):</span></span><br><span class="line">        self.students = students</span><br><span class="line"></span><br><span class="line">class_ = Class(students)</span><br><span class="line"><span class="built_in">len</span>(class_)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="built_in">object</span> of <span class="built_in">type</span> <span class="string">'Class'</span> has no <span class="built_in">len</span>()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-14">任务</h3>
<blockquote>
<p>斐波那契数列是由 0, 1, 1, 2, 3, 5, 8…构成。<br>
<br>请编写一个Fib类，Fib(10)表示数列的前10个元素，print Fib(10) 可以打印出数列的前 10 个元素，len(Fib(10))可以正确返回数列的个数10。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        self.res = []</span><br><span class="line">        self.num = num</span><br><span class="line">        a = <span class="number">0</span></span><br><span class="line">        b = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            self.res.append(a)</span><br><span class="line">            a, b = b, a + b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(self.res)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.num</span><br><span class="line"></span><br><span class="line">f = Fib(<span class="number">10</span>)</span><br><span class="line">print(f)</span><br><span class="line">print(<span class="built_in">len</span>(f))</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="四、类的数学运算">四、类的数学运算</h2>
<p>事实上，Python很多的操作都是通过内建函数来实现的，比如最熟悉的加减乘除，都是通过内建函数来实现的，分别是<code>__add__、__sub__、__mul__、__truediv__</code>。因此，只要我们的自定义类实现了相关的内建函数，我们的类对象，也可以做到加减乘除。</p>
<p>对于有理数，我们可以使用Rational类来表示：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rational</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br></pre></td></tr></tbody></table></figure>
<p>其中，p、q 都是整数，表示有理数 p/q。 如果要让Rational进行加法运算，需要正确实现<code>__add__</code>：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rational</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rational(self.p * r.q + self.q * r.p, self.q * r.q)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'{}/{}'</span>.<span class="built_in">format</span>(self.p, self.q)</span><br></pre></td></tr></tbody></table></figure>
<p>定义好后，就可以尝试一下有理数的加法了：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>r1 = Rational(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>r2 = Rational(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(r1 + r2)</span><br><span class="line"><span class="number">7</span>/<span class="number">6</span></span><br></pre></td></tr></tbody></table></figure>
<p>需要注意<code>__add__()</code>函数，它有一个参数，表示的是运算的第二个操作数，比如：r1 + r2，那么在add()方法中的参数，r指的就是r2，这个参数是运算符重载的时候传递的。</p>
<p>另外，细心的同学可能注意到了，相比加减乘的特殊方法，除法的特殊方法名字较长<code>__truediv__</code>，并且含有true这样的描述，这其实和Python除法是有关系的。</p>
<p>Python的除法可以分为地板除（你没看错，就是地板）和普通除法，地板除的特殊方法是<code>__floordiv__</code>，普通除法是<code>__truediv__</code>。</p>
<p>地板除法和普通除法不一样，地板除法的结果只会向下取整数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = <span class="number">5</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__truediv__(<span class="number">3</span>)</span><br><span class="line"><span class="number">1.6666666666666667</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__floordiv__(<span class="number">3</span>)</span><br><span class="line"><span class="number">1</span> <span class="comment"># 向下取整</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = <span class="number">7</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__floordiv__(<span class="number">3</span>)</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></tbody></table></figure>
<p>在运算中，普通除法使用<code>/</code>表示，而地板除使用<code>//</code>表示。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span> / <span class="number">3</span></span><br><span class="line"><span class="number">1.6666666666666667</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="number">5</span> // <span class="number">3</span></span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-15">任务</h3>
<blockquote>
<p>Rational类虽然可以做加法，但无法做减法、乘法和除法，请继续完善Rational类，实现四则运算。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    <span class="keyword">return</span> gcd(b, a % b)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rational</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__add__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rational(self.p * r.q + self.q * r.p, self.q * r.q)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__sub__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rational(self.p * r.q - self.q * r.p, self.q * r.q)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__mul__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rational(self.p * r.p, self.q * r.q)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__truediv__</span>(<span class="params">self, r</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Rational(self.p * r.q, self.q * r.p)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        g = gcd(self.p, self.q)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'{}/{}'</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(self.p/g), <span class="built_in">int</span>(self.q/g))</span><br><span class="line"></span><br><span class="line">r1 = Rational(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">r2 = Rational(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line">print(r1 + r2)</span><br><span class="line">print(r1 - r2)</span><br><span class="line">print(r1 * r2)</span><br><span class="line">print(r1 / r2)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="五、类的-slots-方法">五、类的__slots__方法</h2>
<p>由于Python是动态语言，任何实例在运行期都可以动态地添加属性。比如：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.score = score</span><br></pre></td></tr></tbody></table></figure>
<p>此时，Student类有三个属性，name、gender、score，由于是动态语言，在运行时，可以随意添加属性。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">student = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">99</span>)</span><br><span class="line">student.age = <span class="number">12</span> <span class="comment"># ==&gt; 动态添加年龄age属性</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果要限制添加的属性，例如，Student类只允许添加 name、gender和score 这3个属性，就可以利用Python的一个特殊的<code>__slots__</code>来实现。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    __slots__ = (<span class="string">'name'</span>, <span class="string">'gender'</span>, <span class="string">'score'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.score = score</span><br></pre></td></tr></tbody></table></figure>
<p>使用<code>__slots__ = ('name', 'gender', 'score')</code>限定Student类的属性，这个时候在外部再次添加动态属性age，将会报错。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">student = Student(<span class="string">'Bob'</span>, <span class="string">'Male'</span>, <span class="number">99</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>student.age = <span class="number">12</span> <span class="comment"># ==&gt; 动态添加年龄age属性</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">AttributeError: <span class="string">'Student'</span> <span class="built_in">object</span> has no attribute <span class="string">'age'</span></span><br></pre></td></tr></tbody></table></figure>
<p><code>__slots__</code>的目的是限制当前类所能拥有的属性，避免因为外部属性的操作导致类属性越来越难以管理。</p>
<h3 id="任务-16">任务</h3>
<blockquote>
<p>假设Person类通过__slots__定义了name和gender，请在派生类Student中通过__slots__继续添加score的定义，使Student类可以实现name、gender和score 3个属性。</p>
</blockquote>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    __slots__ = (<span class="string">'name'</span>, <span class="string">'gender'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line"></span><br><span class="line">    __slots__ = (<span class="string">'score'</span>,)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender, score</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line">        self.score = score</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = Student(<span class="string">'Bob'</span>, <span class="string">'male'</span>, <span class="number">59</span>)</span><br><span class="line">s.name = <span class="string">'Tim'</span></span><br><span class="line">s.score = <span class="number">99</span></span><br><span class="line">print(s.score)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="六、类的-call-方法">六、类的__call__方法</h2>
<p>在Python中，函数其实是一个对象，我们可以将一个函数赋值给一个变量，而不改变函数的功能。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = <span class="built_in">abs</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f</span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">abs</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">abs</span></span><br><span class="line">&lt;built-<span class="keyword">in</span> function <span class="built_in">abs</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.__name__</span><br><span class="line"><span class="string">'abs'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f(-<span class="number">123</span>)</span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></tbody></table></figure>
<p>把内建函数abs()赋值给变量f之后，可以看到f就和abs一样，都是。</p>
<p>由于 f 可以被调用，所以，f 被称为可调用对象，而事实上，所有的函数都是可调用对象。</p>
<p>如果把一个类实例也变成一个可调用对象，可以实现一个特殊的方法<code>__call__()</code>。</p>
<p>例如，我们把Person类变成一个可调用对象：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name, gender</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.gender = gender</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, friend</span>):</span></span><br><span class="line">        print(<span class="string">'My name is {}...'</span>.<span class="built_in">format</span>(self.name))</span><br><span class="line">        print(<span class="string">'My friend is {}...'</span>.<span class="built_in">format</span>(friend))</span><br></pre></td></tr></tbody></table></figure>
<p>接着我们初始化一个Person对象，并对这个对象通过函数的方式调用：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Person(<span class="string">'Bob'</span>, <span class="string">'Male'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p(<span class="string">'Alice'</span>) <span class="comment"># ==&gt; 用函数的方式调用Person类的实例p</span></span><br><span class="line">My name <span class="keyword">is</span> Bob...</span><br><span class="line">My friend <span class="keyword">is</span> Alice...</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-17">任务</h3>
<blockquote>
<p>请实现前面介绍过的斐波那契数列类Fib，加入__call__方法，使得调用的方式如下简单。</p>
</blockquote>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = Fib()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">print</span> f(<span class="number">10</span>)</span><br><span class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>]</span><br></pre></td></tr></tbody></table></figure>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.res = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, num</span>):</span></span><br><span class="line">        a = <span class="number">0</span></span><br><span class="line">        b = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">            self.res.append(a)</span><br><span class="line">            a, b = b, a + b</span><br><span class="line">        <span class="keyword">return</span> self.res</span><br><span class="line"></span><br><span class="line">f = Fib()</span><br><span class="line">print(f(<span class="number">10</span>))</span><br></pre></td></tr></tbody></table></figure>
</details>
<hr>
<h1 id="Python进阶教程笔记（四）模块和包">Python进阶教程笔记（四）模块和包</h1>
<h2 id="一、定义模块">一、定义模块</h2>
<p>Python语言本身提供了非常多的模块，比如数学模块math、cmath、decimal、statistics；文件模块pathlib、stat、shutil等；除了使用官方模块，有时候也需要自定义模块。</p>
<p>如果我们需要创建一个tools模块，用来实现众多的工具函数，那么我们可以创建一个tools.py的文件，并在这个文件里面实现一些函数，如：say_hello()函数、say_goodbye()函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tools.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span>():</span></span><br><span class="line">    print(<span class="string">'hello'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_goodbye</span>():</span></span><br><span class="line">    print(<span class="string">'goodbye'</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>这样就定义了一个叫tools的模块，接着就可以使用这个模块了，在使用之前，我们需要先导入模块，下面我们来详细学习。</p>
<h3 id="任务-18">任务</h3>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://xn--common-9m7iglqjy00aub402jc7m0r3c.py">定义一个公共模块common.py</a>，在common.py中，包含公共函数say_hello(name)，它接受一个参数，输出：Hello 的结果。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># common.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">say_hello</span>(<span class="params">name</span>):</span></span><br><span class="line">    print(<span class="string">'Hello {}'</span>.<span class="built_in">format</span>(name))</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="二、导入模块">二、导入模块</h2>
<p>要使用一个模块，我们必须首先导入该模块。Python使用import语句导入一个模块，Python官方提供很多有用的模块，比如：os模块、sys模块、time模块、math模块等等。</p>
<p>导入官方模块，不需要考虑路径的问题，例如，导入系统自带的模块 math，直接导入即可。如果是导入自定义模块，则需要考虑路径问题，我们下节课继续学习。</p>
<p>导入官方模块math：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br></pre></td></tr></tbody></table></figure>
<p>导入以后，你就可以认为math是一个指向已导入模块的变量，通过该变量，我们可以访问math模块中所定义的所有公开的函数、变量和类：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性：圆周率</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> math</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.pi</span><br><span class="line"><span class="number">3.141592653589793</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 函数：次方</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>math.<span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">8.0</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果希望导入模块的指定部分属性或函数，那么使用<code>from...import...</code>语句。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> pi</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(pi)</span><br><span class="line"><span class="number">3.141592653589793</span></span><br></pre></td></tr></tbody></table></figure>
<p>这个时候，由于pow()函数没有导入，所以是不能使用pow()函数的。</p>
<p>如果希望导入模块里面的所有内容，那么使用<code>from ...import *</code>语句。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> *</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(pi)</span><br><span class="line"><span class="number">3.141592653589793</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">8.0</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果从一个模块导入函数，有可能会遇到导入的函数与本文件的函数冲突的情况。例如：本文件定义了一个pow()函数，同时从math模块也导入了一个pow()函数，这种情况下就会引起冲突；事实上，这种冲突的情况经常发生。</p>
<p>有两种方法可以解决这个问题，第一种是直接导入模块，不指定导入模块里面的具体内容；第二种方法就是使用<code>from ... import as ...</code>语句，as类似重命名，可以把导入的函数或属性重命名为别的名字。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> math <span class="keyword">import</span> <span class="built_in">pow</span> <span class="keyword">as</span> mathpow</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mathpow(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="number">8.0</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-19">任务</h3>
<p>math模块还提供了非常多的数学计算函数，比如：正弦sin()函数，余弦cos()函数，请使用两种导入的方式，使用这两个函数。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line">math.sin(<span class="number">0</span>)</span><br><span class="line">math.cos(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sin, cos</span><br><span class="line">sin(<span class="number">0</span>)</span><br><span class="line">cos(<span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="三、模块导入的路径">三、模块导入的路径</h2>
<p>导入官方模块的时候，不需要考虑路径问题，这是因为在搜索模块的时候，会默认包含官方模块的路径，所以导入官方模块不需要考虑路径的问题。</p>
<p>如果需要导入自定义模块，则需要了解Python导入模块搜索的路径。</p>
<p>通过sys模块，可以知道导入模块的路径。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> sys</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sys.path</span><br><span class="line">[<span class="string">''</span>, <span class="string">'/data/miniconda3/lib/python3.8'</span>, <span class="string">'/data/miniconda3/lib/python3.8/site-packages'</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>它返回的是一个列表，表示的是在搜索Python模块时，会搜索的路径，在示例中，返回了四个路径。我们分析一些关键路径：</p>
<p>第一个路径是<code>''</code>，它是一个空字符串，表达的是当前路径的意思。</p>
<p>第二个路径是<code>/data/miniconda3/lib/python3.8</code>，它是Python默认模块的存放的路径，在这个路径下，可以发现有os、sys等模块的代码。</p>
<p>第三个路径是<code>/data/miniconda3/lib/python3.8/site-packages</code>，它是第三方模块代码的存放路径，在这个路径下，存放的是需要安装的第三方模块。</p>
<p>那如何使用我们前面定义的tools.py模块呢？ 我们在tools.py同级目录，创建main.py文件：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tools <span class="comment"># 导入模块</span></span><br><span class="line"></span><br><span class="line">tools.say_hello() <span class="comment"># 调用模块里面的say_hello()函数</span></span><br><span class="line">tools.say_goodbye() <span class="comment"># 调用模块里面的say_goodbye()函数</span></span><br></pre></td></tr></tbody></table></figure>
<p>就可以运行了。 因为在搜索包的路径时，会搜索当前路径（上述：sys.path结果的第一项），因此在同一个目录内的tools.py模块，可以被搜索到，所以能够import进来。</p>
<h2 id="四、安装第三方模块的方法">四、安装第三方模块的方法</h2>
<p>尽管Python的官方模块已经提供了非常强大的能力，但是仍有大量热心开发者提供了非常好用的第三方库，在实际开发中，也会经常使用，比如Web开发框架，Django、Flask，异步任务框架：Celery等。 在安装Python的时候，Python环境提供了安装第三方模块的工具：pip，通过这个工具，可以非常快捷的安装第三方模块。 安装Django模块：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django</span><br></pre></td></tr></tbody></table></figure>
<p>卸载Django模块：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip uninstall django</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h1 id="Python进阶教程笔记（五）读写文件">Python进阶教程笔记（五）读写文件</h1>
<h2 id="一、向Python程序输入内容">一、向Python程序输入内容</h2>
<p>到目前为止，我们编写的程序都是直接运行的，在运行过程中并没有接收程序外部的输入。比如，通过Python程序，我们可以快速算出从1到100的乘法结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>):</span><br><span class="line">    result = result * i</span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></tbody></table></figure>
<p>但是如果需要计算从1到200的乘法结果，则只能通过修改程序去实现。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">201</span>):</span><br><span class="line">    result = result * i</span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></tbody></table></figure>
<p>如果可以通过输入，改变计算的范围，那就好了，input()函数可以接收外部的输入。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = <span class="built_in">input</span>(<span class="string">'please input number: '</span>)</span><br><span class="line">please <span class="built_in">input</span> number: <span class="number">201</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(num) </span><br><span class="line"><span class="number">201</span></span><br></pre></td></tr></tbody></table></figure>
<p>因此，通过input()函数，则可以改变上面程序运行的范围，注意：输入的是字符串，需要转型为数字类型。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="built_in">input</span>(<span class="string">'please input number: '</span>)</span><br><span class="line"></span><br><span class="line">num = <span class="built_in">int</span>(num)</span><br><span class="line">result = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, num):</span><br><span class="line">    result = result * i</span><br><span class="line"></span><br><span class="line">print(result)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-20">任务</h3>
<p>eval()函数可以把字符串转换为等值的结果，比如eval(‘1+1’)，得到结果为2。请使用eval实现一个简单的计算器，可以输入表达式并打印计算结果。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line">math.sin(<span class="number">0</span>)</span><br><span class="line">math.cos(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sin, cos</span><br><span class="line">sin(<span class="number">0</span>)</span><br><span class="line">cos(<span class="number">0</span>)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="二、打开文本文件">二、打开文本文件</h2>
<p>通过print()可以从数据输出数据，通过input()可以向程序输入数据，但这些都是标准屏幕上的操作，本节课学习文件的读写操作。</p>
<p>Python 提供了open()函数，可以打开一个文件，得到一个文件file对象，而file对象提供相关的方法对文件内容进行读写等操作。</p>
<p>open()函数有若干个参数，比较重要的是以下三个参数：</p>
<ol>
<li>文件路径：指定需要打开的文件的文件路径</li>
<li>打开模式：针对不同文件（二进制文件、文本文件）以及不同操作（读操作、写操作），会有不同的打开模式</li>
<li>编码：设定打开文件的默认编码</li>
</ol>
<p>常用的打开模式如下：</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>t</td>
<td>文本模式（默认）</td>
</tr>
<tr>
<td>x</td>
<td>写模式，新建一个文件</td>
</tr>
<tr>
<td>b</td>
<td>二进制模式，打开二进制文件</td>
</tr>
<tr>
<td>+</td>
<td>更新一个文件（可读可写）</td>
</tr>
<tr>
<td>r</td>
<td>以只读模式打开一个文件</td>
</tr>
<tr>
<td>rb</td>
<td>以二进制格式只读模式打开一个文件</td>
</tr>
<tr>
<td>w</td>
<td>打开一个文件进行写入，如果文件内容已存在，会清除原有的内容</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制格式只写模式打开一个文件，会清除原有的内容</td>
</tr>
<tr>
<td>a</td>
<td>打开一个文件并追加内容，会往文件尾部添加内容</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制格式打开一个文件并追加内容，会往文件尾部添加内容</td>
</tr>
<tr>
<td>w+</td>
<td>打开一个文件进行读写，如果文件内容已存在，会清除原有的内容</td>
</tr>
<tr>
<td>a+</td>
<td>打开一个文件并使用追加进行读写</td>
</tr>
</tbody>
</table>
<p>注意，为了安全操作文件，文件使用完毕后，需要使用close()函数正确关闭。 在当前目录下新建一个test.txt文件，<a target="_blank" rel="noopener external nofollow noreferrer" href="http://xn--main-k84fui065hg4a055b.py">并新建一个main.py</a>，此时文件目录如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">|-- test.txt</span><br><span class="line">+-- main.py</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>) <span class="comment"># 打开test.txt文件</span></span><br><span class="line"><span class="built_in">type</span>(f) <span class="comment"># 打印f的类型(&lt;class '_io.TextIOWrapper'&gt;)</span></span><br><span class="line">f.close() <span class="comment"># 关闭文件</span></span><br></pre></td></tr></tbody></table></figure>
<p>注意，在打开文本文件是并不需要特别指定模式<code>t</code>，因为默认就是以文本方式打开文件的。</p>
<h2 id="三、打开二进制文件">三、打开二进制文件</h2>
<p>除了文本以外，还有大量的非文本文件，比如图片、压缩文件、视频文件、音乐文件等等，这种文件统称为二进制文件，在Python中打开二进制文件，需要不同的打开模式。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>b</td>
<td>二进制模式，打开二进制文件</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制格式只写模式打开一个文件，会清除原有的内容</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制格式打开一个文件并追加内容，会往文件尾部添加内容</td>
</tr>
<tr>
<td>rb</td>
<td>以二进制格式只读模式打开一个文件</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.jpg'</span>, <span class="string">'rb'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
<h2 id="四、读取文件内容">四、读取文件内容</h2>
<p>打开文件之后，就可以读取文件的内容，文件对象提供多种读取文件内容的方法。 打开test.txt文件：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>) <span class="comment"># 打开test.txt文件</span></span><br><span class="line">f.close() <span class="comment"># 关闭文件</span></span><br></pre></td></tr></tbody></table></figure>
<p>test.txt文件有以下内容</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello World.</span><br><span class="line">Hello Python.</span><br><span class="line">Hello Imooc.</span><br></pre></td></tr></tbody></table></figure>
<h3 id="读取若干字符">读取若干字符</h3>
<p>文件对象提供read()方法，可以读取文件中的若干个字符，它提供一个参数size，可以指定读取字符的数量。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = f.read(<span class="number">5</span>)</span><br><span class="line">print(s) <span class="comment"># ==&gt; Hello</span></span><br></pre></td></tr></tbody></table></figure>
<p>当read()之后，访问文件的游标就会移动到第六个字符前面，此时，继续read，将得到Hello后面的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s = f.read(<span class="number">6</span>)</span><br><span class="line">print(s) <span class="comment"># ==&gt; ' World'</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="读取一行">读取一行</h3>
<p>文件对象提供readline()方法，和read()方法类似，可以读取文件中的若干个字符，它也提供一个参数size，可以指定读取字符的数量，不过和read()方法不同的是，readline()方法遇到一行结束的时候，就会返回。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f.close()</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>) <span class="comment"># 重新打开文件</span></span><br><span class="line">s = f.readline(<span class="number">20</span>)</span><br><span class="line">print(s)  <span class="comment"># ==&gt; 'Hello World.\n'</span></span><br></pre></td></tr></tbody></table></figure>
<p>可以看到，打印的内容并没有20个字符，readline最多返回一行的所有字符。</p>
<h3 id="读取多行">读取多行</h3>
<p>文件对象提供readlines()方法，可以读取多行字符，返回一个列表。它提供一个hint参数，表示指定读取的行数，没有指定则默认以列表的形式返回文件所有的字符串。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f.close()</span><br><span class="line">f.<span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">s = f.readlines()</span><br><span class="line">print(s) <span class="comment"># ==&gt; ['Hello World.\n', 'Hello Python.\n', 'Hello Imooc.\n']</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="五、把字符串写入文件">五、把字符串写入文件</h2>
<p>要把字符串内容写入文件，需要使用w的模式打开文件。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>w</td>
<td>打开一个文件进行写入，如果文件内容已存在，会清除原有的内容</td>
</tr>
<tr>
<td>wb</td>
<td>以二进制格式只写模式打开一个文件，会清除原有的内容</td>
</tr>
<tr>
<td>w+</td>
<td>打开一个文件进行读写，如果文件内容已存在，会清除原有的内容</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'w'</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="写入若干字符">写入若干字符</h3>
<p>文件对象提供write方法向文件内写入若干字符，它接受一个字符串参数，表示需要写入的字符串。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line">f.write(<span class="string">'Hello World\n'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="写入若干行">写入若干行</h3>
<p>文件对象提供writelines()方法向文件内容写入多行数据，它接受一个列表，表示需要写入的字符串列表。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lines = [<span class="string">'Hello World\n'</span>, <span class="string">'Hello Python\n'</span>, <span class="string">'Hello Imooc\n'</span>]</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line"></span><br><span class="line">f.writelines(lines)</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-21">任务</h3>
<p>有test.txt文件，包含以下内容：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Hello Python</span><br><span class="line">Hello Imooc</span><br></pre></td></tr></tbody></table></figure>
<p>请从test.txt文件读取以上内容，并将每一行字符串反转，写入test1.txt文件。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dlroW olleH</span><br><span class="line">nohtyP olleH</span><br><span class="line">coomI olleH</span><br></pre></td></tr></tbody></table></figure>
<details><summary> 参考答案 </summary>
<br>
<ol>
<li>
<p>字符串反转可以使用切片实现： reverse = str_[::-1]</p>
</li>
<li>
<p>换行符是’\n’，字符串反转的时候，换行符也会翻转</p>
</li>
</ol>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>)</span><br><span class="line">lines = f.readlines()</span><br><span class="line">f1 = <span class="built_in">open</span>(<span class="string">'test1.txt'</span>, <span class="string">'w'</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    line = line[::-<span class="number">1</span>]</span><br><span class="line">    f1.write(line)</span><br><span class="line"></span><br><span class="line">f1.close()</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="六、往文件追加内容">六、往文件追加内容</h2>
<p>通过<code>w</code>的打开方式打开文件，会清空文件的内容，这在很多场景下是不合适的，比如写系统日志的时候，需要累积随时间推移的所有数据。</p>
<p>Python提供文件追加内容的打开模式，可以往文件尾部添加内容，又不清空文件原有的内容。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>a</td>
<td>打开一个文件并追加内容，会往文件尾部添加内容</td>
</tr>
<tr>
<td>ab</td>
<td>以二进制格式打开一个文件并追加内容，会往文件尾部添加内容</td>
</tr>
<tr>
<td>a+</td>
<td>打开一个文件并使用追加进行读写</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'a'</span>)</span><br><span class="line">f.write(<span class="string">'Hello Everyone\n'</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
<p>使用<code>a</code>的打开方式打开文件，文件游标默认是在文件的尾部，因此，可以便捷的往文件尾部添加内容，除此以外，文件对象还提供seek()方法，可以移动文件的游标位置，它接受一个参数，表示文件的位置，0：文件首部，1：当前位置，2：文件尾部，通过seek()可以把文件游标移动到文件首部但不删除文件的内容。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'a+'</span>)</span><br><span class="line">content = f.readlines()</span><br><span class="line">print(content) <span class="comment"># ==&gt; []</span></span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line">content = f.readlines()</span><br><span class="line">print(content) <span class="comment"># ==&gt; ['Hello World\n', 'Hello Python\n', 'Hello Imooc\n']</span></span><br></pre></td></tr></tbody></table></figure>
<p>第一次<code>print(content)</code>的时候，由于文件游标在文件的尾部，所以readlines()读取不到任何数据，打印了空的结果，第二次<code>print(content)</code>的时候，由于通过seek(0)，文件游标移动到了文件的首部，因此readlines()就返回了文件所有的内容。</p>
<h3 id="任务-22">任务</h3>
<p>假设test.txt文件有以下内容：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br><span class="line">Hello Python</span><br><span class="line">Hello Imooc</span><br></pre></td></tr></tbody></table></figure>
<p>请将文件的内容重复写一份追加到文件的尾部。</p>
<details><summary> 参考答案 </summary>
<br>
使用a的打开方式打开文件，文件游标默认是在文件的尾部，因此，可以便捷的往文件尾部添加内容，除此以外，文件对象还提供seek()方法，可以移动文件的游标位置，它接受一个参数，表示文件的位置：
<ul>
<li>
<p>0：文件首部，</p>
</li>
<li>
<p>1：当前位置，</p>
</li>
<li>
<p>2：文件尾部</p>
</li>
</ul>
<p>通过seek()可以把文件游标移动到文件首部但不删除文件的内容。</p>
<p>f.seek(0):表示将光标定位到文件起始位置</p>
<p>f.seek(1):表示光标定位当当前位置</p>
<p>f.seek(2)：表示将光光标定位到文件尾部</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'a+'</span>)</span><br><span class="line">f.seek(<span class="number">0</span>)</span><br><span class="line">content = f.readlines()</span><br><span class="line">f.seek(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> content:</span><br><span class="line">    f.write(line)</span><br><span class="line">f.close()</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="七、正确关闭文件">七、正确关闭文件</h2>
<p>在进行文件操作的时候，正确关闭一个文件非常重要，如果在文件读写后，没有正确关闭一个文件的话，则有可能导致文件损坏，文件内容丢失等问题。</p>
<p>在一般情况下，我们使用文件对象的close()方法，来关闭一个文件。 但是，使用close()方法，也不是100%安全的，如果在close()文件之前，程序异常退出了，那么文件也得不到正确的关闭。比如：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'a+'</span>)</span><br><span class="line">exit(-<span class="number">1</span>) <span class="comment"># ==&gt; 模拟程序异常退出</span></span><br><span class="line">f.close() <span class="comment"># ==&gt; close语句永远的不到执行</span></span><br></pre></td></tr></tbody></table></figure>
<p>在实际工程中，close()文件之前，为了正确关闭文件，需要考虑各种异常情况，这是非常麻烦的一件事，Python提供<code>with</code>关键字，可以免除这类后顾之忧。</p>
<p><code>with</code>关键字对资源进行访问的场合，会确保不管在使用过程中是否发生异常，都会执行必要的“清理”的操作，释放资源，比如文件使用后自动关闭等等。</p>
<p><code>with</code>的使用方法如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'test.txt'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    content = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> content:</span><br><span class="line">        print(line)</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h1 id="Python进阶教程笔记（六）网络编程">Python进阶教程笔记（六）网络编程</h1>
<p>2020-10-302020-10-30 11:43:20阅读 1450</p>
<h2 id="一、套接字Socket与套接字编程">一、套接字Socket与套接字编程</h2>
<p>要进行网络通信，需要建立起通信双方的连接，连接的双方分别称为客户端和服务端，在Python中，使用套接字socket来建立起网络连接。 套接字包含在socket模块中：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">socket.socket()</span><br></pre></td></tr></tbody></table></figure>
<p>对于客户端和服务端，都是使用socket来建立连接的，但是在使用行为上，客户端和服务端会有一些不一样。</p>
<p>服务端建立需要四个步骤：新建socket、绑定IP和端口(bind)、监听连接(listen)、接受连接(accept)。</p>
<p>客户端建立则简单一些，仅需两个步骤：新建socket、连接服务端(connect)。 当网络连接上以后，客户端和服务端就可以进行数据通信了，套接字通过send()函数发送数据，通过recv()函数接收数据。</p>
<p>先看服务端的过程，新建一个server.py的文件：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment"># 1. 新建socket</span></span><br><span class="line">server.bind((<span class="string">'127.0.0.1'</span>, <span class="number">8999</span>)) <span class="comment"># 2. 绑定IP和端口（其中127.0.0.1为本机回环IP）</span></span><br><span class="line">server.listen(<span class="number">5</span>) <span class="comment"># 3. 监听连接</span></span><br><span class="line">s, addr = server.accept() <span class="comment"># 4. 接受连接</span></span><br><span class="line">print(<span class="string">'connect addr：{}'</span>.<span class="built_in">format</span>(addr))</span><br><span class="line">content =s.recv(<span class="number">1024</span>)</span><br><span class="line">print(<span class="built_in">str</span>(content, encoding=<span class="string">'utf-8'</span>))  <span class="comment"># 接受来自客户端的消息，并编码打印出来</span></span><br><span class="line">s.close()</span><br></pre></td></tr></tbody></table></figure>
<p>如上，服务端就编写完毕，接下来是编写客户端，新建一个client.py的文件：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment"># 1. 新建socket</span></span><br><span class="line">client.connect((<span class="string">'127.0.0.1'</span>, <span class="number">8999</span>)) <span class="comment"># 2. 连接服务端（注意，IP和端口要和服务端一致）</span></span><br><span class="line">client.send(<span class="built_in">bytes</span>(<span class="string">'Hello World. Hello Socket'</span>, encoding=<span class="string">'utf-8'</span>)) <span class="comment"># 发送内容，注意发送的是字节字符串。</span></span><br><span class="line">client.close()</span><br></pre></td></tr></tbody></table></figure>
<p>接着在一个终端先运行服务端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python server.py</span><br></pre></td></tr></tbody></table></figure>
<p>然后再在另外一个终端运行客户端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python client.py</span><br></pre></td></tr></tbody></table></figure>
<p>在服务端的终端，将会输出以下信息：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">connect addr：(<span class="string">'127.0.0.1'</span>, <span class="number">50382</span>)</span><br><span class="line"><span class="string">b'Hello World. Hello Socket'</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-23">任务</h3>
<p>请改造server.py和client.py文件，实现一个echo服务器，使得client.py可以循环接收用户输入并发送给服务端，服务端在收到消息后，也把消息原样返回给client。</p>
<details><summary> 参考答案 </summary>
<br>
1. 请同学在本地编写代码练习
<ol start="2">
<li>通过input()可以接收用户的输入。</li>
</ol>
<p>参考答案：</p>
<p>服务端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server = socket.socket() <span class="comment"># 1. 新建socket</span></span><br><span class="line">server.bind((<span class="string">'127.0.0.1'</span>, <span class="number">8999</span>)) <span class="comment"># 2. 绑定IP和端口（其中127.0.0.1为本机回环IP）</span></span><br><span class="line">server.listen(<span class="number">5</span>) <span class="comment"># 3. 监听连接</span></span><br><span class="line">s, addr = server.accept() <span class="comment"># 4. 接受连接</span></span><br><span class="line">print(<span class="string">'connect addr：{}'</span>.<span class="built_in">format</span>(addr))</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content =s.recv(<span class="number">1024</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(content) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    s.send(content)</span><br><span class="line">    print(<span class="built_in">str</span>(content, encoding=<span class="string">'utf-8'</span>)) <span class="comment"># 接受来自客户端的消息，并打印出来</span></span><br><span class="line"></span><br><span class="line">s.close()</span><br></pre></td></tr></tbody></table></figure>
<p>客户端：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">client = socket.socket() <span class="comment"># 1. 新建socket</span></span><br><span class="line">client.connect((<span class="string">'127.0.0.1'</span>, <span class="number">8999</span>)) <span class="comment"># 2. 连接服务端（注意，IP和端口要和服务端一致）</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    content = <span class="built_in">input</span>(<span class="string">'&gt;&gt;&gt; '</span>)</span><br><span class="line">    client.send(<span class="built_in">bytes</span>(content, <span class="string">'utf-8'</span>)) <span class="comment"># 发送内容，注意发送的是字节字符串。</span></span><br><span class="line">    content = client.recv(<span class="number">1024</span>)</span><br><span class="line">    print(<span class="built_in">str</span>(content, encoding=<span class="string">'utf-8'</span>))</span><br><span class="line"></span><br><span class="line">client.close()</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="二、自带的HTTP服务器">二、自带的HTTP服务器</h2>
<p>在互联网的世界中，网页、手机H5等都是通过HTTP向用户提供服务的，这些信息存储在HTTP服务器中，HTTP服务器是一种特殊的Socket服务器，它在网络连接之上，定义了HTTP协议，使得网页、手机H5等数据，都可以以标准的HTTP协议进行传输。</p>
<p>Python提供了简易的HTTP服务器，可以直接运行起来。 在终端，输入这条命令，就可以启动一个HTTP服务器。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m http.server</span><br></pre></td></tr></tbody></table></figure>
<p>启动成功后，会输出以下信息：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> port <span class="number">8000</span> (http://<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">8000</span>/) ...</span><br></pre></td></tr></tbody></table></figure>
<p>提示HTTP服务器在本机8000端口运行，接着就可以在浏览器输入http://127.0.0.1:8000看到由这个服务器提供的网页。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1217896/perfugi1e8.png?imageView2/2/w/1620" alt=""></p>
<p>这个HTTP服务器会把运行目录的所有文件列出来，并提供下载功能。</p>
<h3 id="任务-24">任务</h3>
<p>Python自带的HTTP服务器，默认的端口为8000端口，同时默认的目录是当前终端启动运行的目录，请启动Python自带的HTTP服务器，指定端口为9999，并指定目录路径为C:/。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -d命令可以指定目录路径</span></span><br><span class="line">python -m http.server <span class="number">9999</span> -d C:/</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="三、发送HTTP请求">三、发送HTTP请求</h2>
<p>在上一节，使用了Python自带的功能启动了一个HTTP服务器，并通过浏览器浏览到了这个HTTP服务器提供的页面。在浏览的过程中，实际上是浏览器向HTTP服务器发送了一个HTTP请求。</p>
<p>除了使用浏览器发送HTTP请求，通过代码也可以向HTTP服务器发送请求，Python提供了相关的库urllib，通过urllib包里面的request，可以向其他HTTP服务器发起请求。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line">response = request.urlopen(<span class="string">'https://www.imooc.com'</span>) <span class="comment"># 向慕课网官网发出请求</span></span><br><span class="line">print(response) <span class="comment"># ==&gt; &lt;http.client.HTTPResponse object at 0x000001377D631948&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>请求成功的话，会得到一个HTTPResponse，它是来自HTTP服务器的一个回应，可以把这个回应的一些信息打印出来。</p>
<p>状态码：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(response.status) <span class="comment"># ==&gt; 200</span></span><br></pre></td></tr></tbody></table></figure>
<p>状态码是一个三位整数，在HTTP协议的标准里面，定义了很多状态码，其中200表示请求是正常的。</p>
<p>响应头：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> k, v <span class="keyword">in</span> response.getheaders():</span><br><span class="line">    print(<span class="string">'{}: {}'</span>.<span class="built_in">format</span>(k, v))</span><br></pre></td></tr></tbody></table></figure>
<p>将会输出以下信息，这是HTTPResponse附带的一些信息，包括服务端的服务器是什么、请求时间、内容类型、内容长度等等。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Server: openresty</span><br><span class="line">Date: Wed, <span class="number">11</span> May <span class="number">2022</span> 03:<span class="number">31</span>:05 GMT</span><br><span class="line">Content-Type: text/html; charset=UTF-<span class="number">8</span></span><br><span class="line">Content-Length: <span class="number">238378</span></span><br><span class="line">Connection: close</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">X-Varnish: <span class="number">878106536</span> <span class="number">878106405</span></span><br><span class="line">Age: <span class="number">66</span></span><br><span class="line">Via: <span class="number">1.1</span> varnish (Varnish/<span class="number">6.0</span>)</span><br><span class="line">X-Cache: HIT <span class="keyword">from</span> CS43</span><br><span class="line">Accept-Ranges: <span class="built_in">bytes</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="四、requests库">四、requests库</h2>
<p>Python官方提供的urllib库可以满足一般情况下的HTTP操作，但是urllib这个库设计是用来处理url地址的，并不是专门处理HTTP操作的包。因此，在很多场景下，一般会使用requests库来进行HTTP请求。</p>
<p>requests库是著名的Python第三方库，使用requests库，可以定制化你的HTTP请求，包括请求方法，请求参数等等。</p>
<p>由于requests是第三方库，因此在使用前，需要安装。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install requests</span><br></pre></td></tr></tbody></table></figure>
<p>安装完成后，使用requests库来请求百度。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">response = requests.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="comment"># 打印状态码</span></span><br><span class="line">print(response.status_code)</span><br><span class="line"><span class="comment"># 打印回应头</span></span><br><span class="line">print(response.headers)</span><br></pre></td></tr></tbody></table></figure>
<p>在一般的使用上，requests和urllib没有太大区别，但是在复杂的场景中，requests可以提供urllib无法提供的强大功能。因此，在使用上，建议使用requests库代替urllib库来进行HTTP请求等的操作。</p>
<h2 id="五、HTTP响应的内容">五、HTTP响应的内容</h2>
<p>通过urllib或者requests请求后，会得到一个HTTPResponse，HTTPResponse拥有状态码、回应头等的信息。</p>
<p>但我们知道，对于一个页面，通常是由文字、图片等信息组成的，这些属于一个HTTPResponse的内容。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">content = <span class="built_in">str</span>(response.content, encoding=<span class="string">'utf-8'</span>) <span class="comment"># ==&gt; 打印具体内容</span></span><br></pre></td></tr></tbody></table></figure>
<p>打印的结果是一个很长的字符串，显得杂乱无章，但其实它是由结构的，它是一个标准的HTML页面，可以从页面内容里面获取很多有用的数据。</p>
<p>网络爬虫是典型的应用程序，它的工作原理就是通过不断的请求互联网的页面，并从回应中解析获取出有用的数据；数据积累后，可以有很多用处。</p>
<p>通过requests获得网页的内容后，我们可以尝试使用一些简单的方法获取页面的内容。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">content_list = content.split(<span class="string">'\n'</span>) <span class="comment"># 分行</span></span><br><span class="line"><span class="built_in">len</span>(content_list) <span class="comment"># 打印页面内容的行数</span></span><br></pre></td></tr></tbody></table></figure>
<p>在网页中，页面内部链接其他资源的信息是通过href提供的，通过字符串匹配的方式可以过滤出包含链接的行。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> content_list:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'href'</span> <span class="keyword">in</span> line:</span><br><span class="line">        print(line.strip())</span><br></pre></td></tr></tbody></table></figure>
<hr>
<h1 id="Python进阶教程笔记（七）函数式编程">Python进阶教程笔记（七）函数式编程</h1>
<h2 id="一、什么是函数式编程">一、什么是函数式编程</h2>
<ul>
<li>函数：function，逻辑功能的单位</li>
<li>函数式：functional，一种编程范式</li>
<li>特点：</li>
</ul>
<ol>
<li>把计算视为函数而不是指令</li>
<li>代码简洁，方便阅读，容易理解</li>
<li>纯函数式编程：不需要变量、测试简单</li>
</ol>
<h2 id="二、Python的函数式编程">二、Python的函数式编程</h2>
<ul>
<li>不是纯函数式编程：允许有变量</li>
<li>支持高阶函数：函数可以作为变量</li>
<li>支持闭包：可以返回函数</li>
<li>支持匿名函数</li>
</ul>
<h2 id="三、把函数作为参数">三、把函数作为参数</h2>
<p>在前面，我们了解了高阶函数的概念，并编写了一个简单的高阶函数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y, f</span>):</span></span><br><span class="line">    <span class="keyword">return</span> f(x) + f(y)</span><br></pre></td></tr></tbody></table></figure>
<p>如果传入abs作为参数f的值：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(-<span class="number">5</span>, <span class="number">9</span>, <span class="built_in">abs</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>根据函数的定义，函数执行的代码实际上是：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">abs</span>(-<span class="number">5</span>) + <span class="built_in">abs</span>(<span class="number">9</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>由于参数 x, y 和 f 都可以任意传入，如果 f 传入其他函数，就可以得到不同的返回值。</p>
<h3 id="任务-25">任务</h3>
<p>利用上面定义的add(x, y, f)函数，计算以下的值：</p>
<p><img src="https://img2.mukewang.com/5f48d1330001173500930027.jpg" alt=""></p>
<details><summary> 参考答案 </summary>
<br>
<p>计算平方根可以利用math包的sqrt()函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y, f</span>):</span></span><br><span class="line">    <span class="keyword">return</span> f(x) + f(y)</span><br><span class="line"></span><br><span class="line">print(add(<span class="number">25</span>, <span class="number">9</span>, math.sqrt))</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="四、map-函数">四、map()函数</h2>
<p>map()是 Python 内置的高阶函数，它接收一个函数 f 和一个 list，并通过把函数 f依次作用在list的每个元素上，map()函数会返回一个迭代器，可以依次迭代得到原来list的元素被函数f处理后的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">map</span>(f, <span class="built_in">list</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>例如，对于list [1, 2, 3, 4, 5, 6, 7, 8, 9]。 如果希望把list的每个元素都作平方，就可以利用map()函数。</p>
<p><img src="https://ask.qcloudimg.com/http-save/yehe-1217896/vnh16hhl2j.png?imageView2/2/w/1620" alt=""></p>
<p>我们定义需要传入函数f(x)=x*x，就可以利用map()函数完成这个计算：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x*x</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">map</span>(f, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></tbody></table></figure>
<p>得到结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">25</span>, <span class="number">36</span>, <span class="number">49</span>, <span class="number">64</span>, <span class="number">81</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>由于list包含的元素可以是任何类型，因此，map() 不仅仅可以处理只包含数值的 list，事实上它可以处理包含任意类型的 list，只要传入的函数f可以处理这种数据类型。</p>
<h3 id="任务-26">任务</h3>
<p>假设用户输入的英文名字不规范，没有按照首字母大写，后续字母小写的规则，请利用map()函数，把一个list（包含若干不规范的英文名字）变成一个包含规范英文名字的list：</p>
<p>输入：[‘alice’, ‘BOB’, ‘CanDY’]<br>
输出：[‘Alice’, ‘Bob’, ‘Candy’]</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">format_name</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s[<span class="number">0</span>].upper() + s[<span class="number">1</span>:].lower()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">map</span>(format_name, [<span class="string">'alice'</span>, <span class="string">'BOB'</span>, <span class="string">'CanDY'</span>]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="五、reduce-函数">五、reduce()函数</h2>
<p>和map函数一样，reduce()函数也是Python内置的一个高阶函数。reduce()函数接收的参数和 map() 类似，一个函数 f，一个list，但行为和 map()不同，reduce()传入的函数 f 必须接收两个参数，reduce()对list的每个元素反复调用函数f，并返回最终结果值。</p>
<p>在python2中，reduce()函数和map()函数一样，可以直接使用，但是在python3中，reduce()函数被收录到functools包内，需要引入functools才可以使用。 例如，编写一个f函数，接收x和y，返回x和y的和：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></tbody></table></figure>
<p>调用 reduce(f, [1, 3, 5, 7, 9])：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(reduce(f, [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>])) <span class="comment"># ==&gt; 25</span></span><br></pre></td></tr></tbody></table></figure>
<p>得到的结果是25，实际过程是这样的，reduce()函数会做如下计算：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">先计算头两个元素：f(<span class="number">1</span>, <span class="number">3</span>)，结果为<span class="number">4</span>；</span><br><span class="line">再把结果和第<span class="number">3</span>个元素计算：f(<span class="number">4</span>, <span class="number">5</span>)，结果为<span class="number">9</span>；</span><br><span class="line">再把结果和第<span class="number">4</span>个元素计算：f(<span class="number">9</span>, <span class="number">7</span>)，结果为<span class="number">16</span>；</span><br><span class="line">再把结果和第<span class="number">5</span>个元素计算：f(<span class="number">16</span>, <span class="number">9</span>)，结果为<span class="number">25</span>；</span><br><span class="line">由于没有更多的元素了，计算结束，返回结果<span class="number">25</span>。</span><br></pre></td></tr></tbody></table></figure>
<p>上述计算实际上是对 list 的所有元素求和。虽然Python内置了求和函数sum()，但是，利用reduce()求和也很简单。 reduce()还可以接收第3个可选参数，作为计算的初始值。如果把初始值设为100，计算：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(reduce(f, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>], <span class="number">100</span>)) <span class="comment"># ==&gt; 125</span></span><br></pre></td></tr></tbody></table></figure>
<p>结果将变为125，因为第一轮计算是：</p>
<p>计算初始值和第一个元素：f(100, 1)，结果为101。</p>
<h3 id="任务-27">任务</h3>
<p>Python内置了求和函数sum()，但没有求积的函数，请利用reduce()来求积</p>
<p>输入：[1, 3, 5, 7, 9]<br>
输出：13579的结果</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prod</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x * y</span><br><span class="line"></span><br><span class="line">print(reduce(prod, [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]))</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="六、filter-函数">六、filter()函数</h2>
<p>filter()函数是 Python 内置的另一个有用的高阶函数，filter()函数接收一个函数 f 和一个list，这个函数 f 的作用是对每个元素进行判断，返回 True或 False，filter()根据判断结果自动过滤掉不符合条件的元素，并返回一个迭代器，可以迭代出所有符合条件的元素。</p>
<p>例如，要从一个list [1, 4, 6, 7, 9, 12, 17]中删除偶数，保留奇数，首先，要编写一个判断奇数的函数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_odd</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后，利用filter()过滤掉偶数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">filter</span>(is_odd, [<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">17</span>]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></tbody></table></figure>
<p>结果：1,7,9,17。 利用filter()函数，可以完成很多很有用的功能，例如，删除 None 或者空字符串：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_not_empty</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s <span class="keyword">and</span> <span class="built_in">len</span>(s.strip()) &gt; <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">filter</span>(is_not_empty, [<span class="string">'test'</span>, <span class="literal">None</span>, <span class="string">''</span>, <span class="string">'str'</span>, <span class="string">'  '</span>, <span class="string">'END'</span>]):</span><br><span class="line">    print(item)</span><br></pre></td></tr></tbody></table></figure>
<p>结果：test, str, END 注意：注意: s.strip()会默认删除空白字符（包括’\n’, ‘\r’, ‘\t’, ’ ')，如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'     123'</span></span><br><span class="line">s.strip() <span class="comment"># ==&gt; 123</span></span><br><span class="line">s= <span class="string">'\t\t123\r\n'</span></span><br><span class="line">s.strip() <span class="comment"># ==&gt; 123</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-28">任务</h3>
<p>请利用filter()过滤出1~100中平方根是整数的数，即结果应该是：1, 4, 9, 16, 25, 36, 49, 64, 81, 100。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_sqrt</span>(<span class="params">x</span>):</span></span><br><span class="line">    r = <span class="built_in">int</span>(math.sqrt(x))</span><br><span class="line">    <span class="keyword">return</span> r * r == x</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">filter</span>(is_sqrt, <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">101</span>)):</span><br><span class="line">    print(item)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="七、自定义排序函数">七、自定义排序函数</h2>
<p>Python内置的 sorted()函数可对list进行排序：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>([<span class="number">36</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">21</span>])</span><br><span class="line">[<span class="number">5</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">21</span>, <span class="number">36</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到，sorted()函数，默认是由小到大排序列表的元素。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>score = [(<span class="string">'Alice'</span>, <span class="number">72</span>), (<span class="string">'Candy'</span>, <span class="number">90</span>), (<span class="string">'Bob'</span>, <span class="number">62</span>)]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">sorted</span>(score)</span><br><span class="line">[(<span class="string">'Alice'</span>, <span class="number">72</span>), (<span class="string">'Bob'</span>, <span class="number">62</span>), (<span class="string">'Candy'</span>, <span class="number">90</span>)]</span><br></pre></td></tr></tbody></table></figure>
<p>当list的每一个元素又是一个<a target="_blank" rel="noopener external nofollow noreferrer" href="https://cloud.tencent.com/product/tke?from=10680">容器</a>时，则会以第一个元素来排序，比如在score中，每个元素都是包含名字和成绩的一个tuple，sorted()函数则按名字首字母进行了排序并返回。</p>
<p>对于上述排序成绩的情况，默认是按照第一个名字进行排序的，有没有办法让sorted()函数按照成绩来进行排序呢？</p>
<p>如果需要按照成绩高低进行排序，需要指定排序的字段是成绩，sorted接受key参数，用来指定排序的字段，key的值是一个函数，接受待排序列表的元素作为参数，并返回对应需要排序的字段。因此，sorted()函数也是高阶函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">k</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">return</span> item[<span class="number">1</span>] <span class="comment"># ==&gt; 按成绩排序，成绩是第二个字段</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">sorted</span>(score, key=k)</span><br></pre></td></tr></tbody></table></figure>
<p>得到结果：[(‘Bob’, 62), (‘Alice’, 72), (‘Candy’, 90)] 。 如果需要倒序，指定reverse参数即可。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sorted</span>(score, key=k, reverse=<span class="literal">True</span>)</span><br></pre></td></tr></tbody></table></figure>
<p>得到结果：[(‘Candy’, 90), (‘Alice’, 72), (‘Bob’, 62)] 。</p>
<h3 id="任务-29">任务</h3>
<p>对字符串排序时，有时候忽略大小写排序更符合习惯。请利用sorted()高阶函数，实现忽略大小写排序的算法。<br>
输入：[‘bob’, ‘about’, ‘Zoo’, ‘Credit’]<br>
输出：[‘about’, ‘bob’, ‘Credit’, ‘Zoo’]</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">k</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="keyword">return</span> item.lower()</span><br><span class="line"></span><br><span class="line"><span class="built_in">sorted</span>([<span class="string">'bob'</span>, <span class="string">'about'</span>, <span class="string">'Zoo'</span>, <span class="string">'Credit'</span>], key=k)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="八、返回函数">八、返回函数</h2>
<p>在函数内部，是可以定义子函数的。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>():</span></span><br><span class="line">    <span class="comment"># 定义子函数</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">sub_func</span>():</span></span><br><span class="line">        print(<span class="string">'call sub_func.'</span>)</span><br><span class="line">    sub_func()</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>func()</span><br><span class="line">call sub_func.</span><br></pre></td></tr></tbody></table></figure>
<p>作为高阶函数，可以接受函数作为参数，其实高阶函数，除了不仅仅可以返回int、str、list、dict等数据类型，还可以返回函数。因此，可以把函数的子函数返回。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">    print(<span class="string">'call f()...'</span>)</span><br><span class="line">    <span class="comment"># 定义函数g:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">        print(<span class="string">'call g()...'</span>)</span><br><span class="line">    <span class="comment"># 返回函数g:</span></span><br><span class="line">    <span class="keyword">return</span> g</span><br></pre></td></tr></tbody></table></figure>
<p>仔细观察上面的函数定义，我们在函数 f 内部又定义了一个函数 g。由于函数 g 也是一个对象，函数名 g 就是指向函数 g 的变量，所以，最外层函数 f 可以返回变量 g，也就是函数 g 本身。 调用函数 f，我们会得到 f 返回的一个函数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = f()   <span class="comment"># 调用f()</span></span><br><span class="line">call f()...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x   <span class="comment"># 变量x是f()返回的函数：</span></span><br><span class="line">&lt;function f.&lt;<span class="built_in">locals</span>&gt;.g at <span class="number">0x7f4a4936dbf8</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>x()   <span class="comment"># x指向函数，因此可以调用</span></span><br><span class="line">call g()...   <span class="comment"># 调用x()就是执行g()函数定义的代码</span></span><br></pre></td></tr></tbody></table></figure>
<p>有必要注意的是，返回函数和返回函数值的语句是非常类似的，返回函数时，不能带小括号，而返回函数值时，则需要带上小括号以调用函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 返回函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myabs</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回函数值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myabs</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(x)</span><br></pre></td></tr></tbody></table></figure>
<p>返回函数有很多应用，比如可以将一些计算延迟执行，举个例子，定义一个普通的求和函数。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_sum</span>(<span class="params">list_</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(list_)</span><br></pre></td></tr></tbody></table></figure>
<p>调用calc_sum()函数时，将立刻计算并得到结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>calc_sum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<p>但是，如果返回一个函数，就可以“延迟计算”：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_sum</span>(<span class="params">list_</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>():</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(list_)</span><br><span class="line">    <span class="keyword">return</span> lazy_sum</span><br></pre></td></tr></tbody></table></figure>
<p>调用calc_sum()并没有计算出结果，而是返回函数:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = calc_sum([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f</span><br><span class="line">&lt;function calc_sum.&lt;<span class="built_in">locals</span>&gt;.lazy_sum at <span class="number">0x7f4a4936db70</span>&gt;</span><br></pre></td></tr></tbody></table></figure>
<p>对返回的函数进行调用时，才计算出结果:</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f()</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></tbody></table></figure>
<p>由于可以返回函数，我们在后续代码里就可以决定到底要不要调用该函数。</p>
<h3 id="任务-30">任务</h3>
<p>请编写一个函数calc_prod(list_)，它接收一个list，返回一个函数，返回函数可以计算参数的乘积。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_prod</span>(<span class="params">list_</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lazy_prod</span>():</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x, y</span>):</span></span><br><span class="line">            <span class="keyword">return</span> x * y</span><br><span class="line">        <span class="keyword">return</span> reduce(f, list_, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> lazy_prod</span><br><span class="line"></span><br><span class="line">f = calc_prod([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line">f()</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="九、闭包">九、闭包</h2>
<p>在函数内部定义的函数和外部定义的函数是一样的，只是他们无法被外部访问：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">    print(<span class="string">'g()...'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">    print(<span class="string">'f()...'</span>)</span><br><span class="line">    <span class="keyword">return</span> g</span><br></pre></td></tr></tbody></table></figure>
<p>将g的定义移入函数 f 内部，防止其他代码调用 g：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">    print(<span class="string">'f()...'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">        print(<span class="string">'g()...'</span>)</span><br><span class="line">    <span class="keyword">return</span> g</span><br></pre></td></tr></tbody></table></figure>
<p>但是，考察上一小节定义的 calc_sum 函数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc_sum</span>(<span class="params">list_</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">lazy_sum</span>():</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(list_)</span><br><span class="line">    <span class="keyword">return</span> lazy_sum</span><br></pre></td></tr></tbody></table></figure>
<p>注意: 发现没法把 lazy_sum 移到 calc_sum 的外部，因为它引用了 calc_sum 的参数 list_。</p>
<p>像这种内层函数引用了外层函数的变量（参数也算变量），然后返回内层函数的情况，称为闭包（Closure）。</p>
<p>闭包的特点是返回的函数还引用了外层函数的局部变量，所以，要正确使用闭包，就要确保引用的局部变量在函数返回后不能变。举例如下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 希望一次返回3个函数，分别计算1x1,2x2,3x3:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>():</span></span><br><span class="line">             <span class="keyword">return</span> i*i</span><br><span class="line">        fs.append(f)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line"></span><br><span class="line">f1, f2, f3 = count()</span><br></pre></td></tr></tbody></table></figure>
<p>你可能认为调用f1()，f2()和f3()结果应该是1，4，9，但实际结果全部都是 9（请自己动手验证）。</p>
<p>原因就是当count()函数返回了3个函数时，这3个函数所引用的变量 i 的值已经变成了3。由于f1、f2、f3并没有被调用，所以，此时他们并未计算 i*i，当 f1 被调用时：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f1()</span><br><span class="line"><span class="number">9</span>     <span class="comment"># 因为f1现在才计算i*i，但现在i的值已经变为3</span></span><br></pre></td></tr></tbody></table></figure>
<p>因此，返回函数不要引用任何循环变量，或者后续会发生变化的变量。</p>
<h3 id="任务-31">任务</h3>
<p>返回闭包不能引用循环变量，请改写count()函数，让它正确返回能计算1x1、2x2、3x3的函数。</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">j</span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">                <span class="keyword">return</span> j*j</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        r = f(i)</span><br><span class="line">        fs.append(r)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line">f1, f2, f3 = count()</span><br><span class="line">print(f1(), f2(), f3())</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="十、匿名函数">十、匿名函数</h2>
<p>高阶函数可以接收函数做参数，有些时候，我们不需要显式地定义函数，直接传入匿名函数更方便。</p>
<p>在Python中，对匿名函数提供了有限支持。还是以map()函数为例，计算 f(x)=x * x时，f(x)就是作为参数传入map的。 在前面，我们是显式的定义了一个f(x)的函数，除此以外，其实可以直接传入匿名函数。</p>
<p>匿名函数使用lambda定义：lambda x: x * x，就可以完成原来显式定义的f(x)函数的功能，冒号前面的x表示匿名函数的参数，后面的是一个表达式，匿名函数有个限制，就是只能有一个表达式，不写return，返回值就是该表达式的结果。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result = [item <span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">map</span>(<span class="keyword">lambda</span> x: x * x, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>])]</span><br><span class="line">print(result) <span class="comment"># ==&gt; [1, 4, 9, 16, 25, 36, 49, 64, 81]</span></span><br></pre></td></tr></tbody></table></figure>
<p>同理，对于reduce()函数，也同样可以通过定义匿名函数来实现相同的逻辑。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">reduce(<span class="keyword">lambda</span> x, y: x + y, [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">7</span>,<span class="number">9</span>])</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-32">任务</h3>
<p>对字符串排序时，有时候忽略大小写排序更符合习惯。请利用sorted()高阶函数和lambda匿名函数，实现忽略大小写排序的算法。<br>
输入：[‘bob’, ‘about’, ‘Zoo’, ‘Credit’]<br>
输出：[‘about’, ‘bob’, ‘Credit’, ‘Zoo’]</p>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>():</span></span><br><span class="line">    fs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">j</span>):</span></span><br><span class="line">            <span class="function"><span class="keyword">def</span> <span class="title">g</span>():</span></span><br><span class="line">                <span class="keyword">return</span> j*j</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">        r = f(i)</span><br><span class="line">        fs.append(r)</span><br><span class="line">    <span class="keyword">return</span> fs</span><br><span class="line">f1, f2, f3 = count()</span><br><span class="line">print(f1(), f2(), f3())</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="十一、编写无参数的decorator">十一、编写无参数的decorator</h2>
<p>Python的 decorator 本质上就是一个高阶函数，它接收一个函数作为参数，然后，返回一个新函数。</p>
<p>使用 decorator 用Python提供的 @ 语法，这样可以避免手动编写 f = decorate(f) 这样的代码。</p>
<p>考察一个@log的定义：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">x</span>):</span></span><br><span class="line">        print(<span class="string">'call '</span> + f.__name__ + <span class="string">'()...'</span>)</span><br><span class="line">        <span class="keyword">return</span> f(x)</span><br><span class="line">    <span class="keyword">return</span> fn</span><br></pre></td></tr></tbody></table></figure>
<p>对于阶乘函数，@log工作得很好：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x*y, <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">print(factorial(<span class="number">10</span>))</span><br></pre></td></tr></tbody></table></figure>
<p>结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">call factorial()...</span><br><span class="line"><span class="number">3628800</span></span><br></pre></td></tr></tbody></table></figure>
<p>但是，对于参数不是一个的函数，调用将报错：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">print(add(<span class="number">1</span>, <span class="number">2</span>))</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>print(add(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: fn() takes <span class="number">1</span> positional argument but <span class="number">2</span> were given</span><br></pre></td></tr></tbody></table></figure>
<p>因为 add() 函数需要传入两个参数，但是 @log 写死了只含一个参数的返回函数。</p>
<p>要让 @log 自适应任何参数定义的函数，可以利用Python的 args 和 *kwargs，保证任意个数的参数总是能正常调用：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">        print(<span class="string">'call '</span> + f.__name__ + <span class="string">'()...'</span>)</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> fn</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-33">任务</h3>
<p>请编写一个@performance，它可以打印出函数调用的时间。</p>
<details><summary> 参考答案 </summary>
<br>
计算函数调用的时间可以记录调用前后的当前时间戳，然后计算两个时间戳的差。
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">performance</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">        t1 = time.time()</span><br><span class="line">        r = f(*args, **kw)</span><br><span class="line">        t2 = time.time()</span><br><span class="line">        print(<span class="string">'call %s() in %fs'</span> % (f.__name__, (t2 - t1)))</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="keyword">return</span> fn</span><br><span class="line"></span><br><span class="line"><span class="meta">@performance</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x*y, <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">print(factorial(<span class="number">10</span>))</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="十二、编写有参数的decorator">十二、编写有参数的decorator</h2>
<p>考察上一节的 @log 装饰器：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fn</span>(<span class="params">x</span>):</span></span><br><span class="line">        print(<span class="string">'call '</span> + f.__name__ + <span class="string">'()...'</span>)</span><br><span class="line">        <span class="keyword">return</span> f(x)</span><br><span class="line">    <span class="keyword">return</span> fn</span><br></pre></td></tr></tbody></table></figure>
<p>发现对于被装饰的函数，log打印的语句是不能变的（除了函数名）。</p>
<p>如果有的函数非常重要，希望打印出’[INFO] call xxx()…‘。 有的函数不太重要，希望打印出’[DEBUG] call xxx()…'。 这时，log函数本身就需要传入’INFO’或’DEBUG’这样的参数，类似这样：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@log(<span class="params"><span class="string">'DEBUG'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_func</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>把上面的定义翻译成高阶函数的调用，就是：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">my_func = log(<span class="string">'DEBUG'</span>)(my_func)</span><br></pre></td></tr></tbody></table></figure>
<p>上面的语句看上去还是比较绕，再展开一下：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_decorator = log(<span class="string">'DEBUG'</span>)</span><br><span class="line">my_func = log_decorator(my_func)</span><br></pre></td></tr></tbody></table></figure>
<p>上面的语句又相当于：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">log_decorator = log(<span class="string">'DEBUG'</span>)</span><br><span class="line"><span class="meta">@log_decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_func</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></tbody></table></figure>
<p>所以，带参数的log函数首先返回一个decorator函数，再让这个decorator函数接收my_func并返回新函数，相当于是在原有的二层嵌套里面，增加了一层嵌套：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">prefix</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log_decorator</span>(<span class="params">f</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">            print(<span class="string">'[{}] {}()...'</span>.<span class="built_in">format</span>(prefix, f.__name__))</span><br><span class="line">            <span class="keyword">return</span> f(*args, **kw)</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> log_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@log(<span class="params"><span class="string">'DEBUG'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">test()</span><br></pre></td></tr></tbody></table></figure>
<p>执行结果：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] test()...</span><br></pre></td></tr></tbody></table></figure>
<p>对于这种三层嵌套的decorator定义，你可以先把它拆开：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 标准decorator:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log_decorator</span>(<span class="params">f</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kw</span>):</span></span><br><span class="line">        print(<span class="string">'[{}] {}()...'</span>.<span class="built_in">format</span>(prefix, f.__name__))</span><br><span class="line">        <span class="keyword">return</span> f(*args, **kw)</span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"><span class="keyword">return</span> log_decorator</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回decorator:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>(<span class="params">prefix</span>):</span></span><br><span class="line">    <span class="keyword">return</span> log_decorator(f)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-34">任务</h3>
<p>上一节的@performance只能打印秒，请给 @performace 增加一个参数，允许传入’s’或’ms’：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@performance(<span class="params"><span class="string">'ms'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x*y, <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<details><summary> 参考答案 </summary>
<br>
要实现带参数的@performance，就需要实现：
<p><code>​my_func = performance('ms')(my_func)</code></p>
<p>需要三层嵌套的decorator来实现。</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">performance</span>(<span class="params">unit</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perf_decorator</span>(<span class="params">f</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            t1 = time.time()</span><br><span class="line">            r = f(*args, **kwargs)</span><br><span class="line">            t2 = time.time()</span><br><span class="line">            t = (t2 - t1) * <span class="number">1000</span> <span class="keyword">if</span> unit == <span class="string">'ms'</span> <span class="keyword">else</span> (t2 - t1)</span><br><span class="line">            print(<span class="string">'call {}() in {} {}'</span>.<span class="built_in">format</span>(f.__name__, t, unit))</span><br><span class="line">            <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line">    <span class="keyword">return</span> perf_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@performance(<span class="params"><span class="string">'ms'</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factorial</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x*y, <span class="built_in">range</span>(<span class="number">1</span>, n+<span class="number">1</span>))</span><br><span class="line">factorial(<span class="number">10</span>)</span><br></pre></td></tr></tbody></table></figure>
</details>
<h2 id="十三、偏函数">十三、偏函数</h2>
<p>当一个函数有很多参数时，调用者就需要提供多个参数。如果减少参数个数，就可以简化调用者的负担。</p>
<p>比如，int()函数可以把字符串转换为整数，当仅传入字符串时，int()函数默认按十进制转换：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">'12345'</span>)</span><br><span class="line"><span class="number">12345</span></span><br></pre></td></tr></tbody></table></figure>
<p>但int()函数还提供额外的base参数，默认值为10。如果传入base参数，就可以做 N 进制的转换：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">'12345'</span>, base=<span class="number">8</span>)</span><br><span class="line"><span class="number">5349</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">int</span>(<span class="string">'12345'</span>, <span class="number">16</span>)</span><br><span class="line"><span class="number">74565</span></span><br></pre></td></tr></tbody></table></figure>
<p>假设要转换大量的二进制字符串，每次都传入int(x, base=2)非常麻烦，于是，我们想到，可以定义一个int2()的函数，默认把base=2传进去：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">int2</span>(<span class="params">x, base=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(x, base)</span><br></pre></td></tr></tbody></table></figure>
<p>这样，我们转换二进制就非常方便了：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>int2(<span class="string">'1000000'</span>)</span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int2(<span class="string">'1010101'</span>)</span><br><span class="line"><span class="number">85</span></span><br></pre></td></tr></tbody></table></figure>
<p>偏函数指的就是“创建一个调用另外一个部分参数或变量已经预置的函数”的函数的用法，如上所示，int()函数的base参数，没有指定的时候，默认是以十进制工作的，当指定base=2的时候，int2实际上就变成了部分参数(base)已经预置了的偏函数。 functools.partial就是帮助我们创建一个偏函数的，不需要我们自己定义int2()，可以直接使用下面的代码创建一个新的函数int2：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> functools</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int2 = functools.partial(<span class="built_in">int</span>, base=<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int2(<span class="string">'1000000'</span>)</span><br><span class="line"><span class="number">64</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>int2(<span class="string">'1010101'</span>)</span><br><span class="line"><span class="number">85</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="任务-35">任务</h3>
<p>在前面，我们在sorted这个高阶函数中传入自定义排序函数就可以实现忽略大小写排序。请用functools.partial把这个复杂调用变成一个简单的函数：</p>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sorted_ignore_case([<span class="string">'bob'</span>, <span class="string">'about'</span>, <span class="string">'Zoo'</span>, <span class="string">'Credit'</span>])</span><br></pre></td></tr></tbody></table></figure>
<details><summary> 参考答案 </summary>
<br>
<figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line">sorted_ignore_case = functools.partial(<span class="built_in">sorted</span>, key=<span class="keyword">lambda</span> item: item.lower())</span><br><span class="line">sorted_ignore_case([<span class="string">'bob'</span>, <span class="string">'about'</span>, <span class="string">'Zoo'</span>, <span class="string">'Credit'</span>])</span><br></pre></td></tr></tbody></table></figure>
</details>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:lixingzee@gmail.com" rel="external nofollow noreferrer">李星泽</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lxz9.com/2022/05/20/python_advanced/">http://lxz9.com/2022/05/20/python_advanced/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lxz9.com" target="_blank">生信技术</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2022/05/26/XZa1kq.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://z3.ax1x.com/2021/01/19/sgZ5y6.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://z3.ax1x.com/2021/01/19/sgZ5y6.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://z3.ax1x.com/2021/01/19/sgZIOK.jpg" rel="external nofollow noreferrer" target="_blank"><img class="post-qr-code-img" src="https://z3.ax1x.com/2021/01/19/sgZIOK.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/07/docker_advanced/"><img class="next-cover" src="https://s1.ax1x.com/2022/04/17/LN4GtO.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Docker 进阶篇</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://z3.ax1x.com/2021/03/10/6JSyoq.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">李星泽</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">47</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">55</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/lxingze"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://blog.csdn.net/m0_49960764" rel="external nofollow noreferrer" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="https://z3.ax1x.com/2021/11/25/oAI0h9.jpg" rel="external nofollow noreferrer" target="_blank" title="微信公众号"><i class="iconfont icon-weixin"></i></a><a class="social-icon" href="https://space.bilibili.com/113291922?from=search&amp;seid=3526734520747213504&amp;spm_id_from=333.337.0.0" rel="external nofollow noreferrer" target="_blank" title="bilibili"><i class="iconfont icon-bilibili-copy"></i></a><a class="social-icon" href="mailto:lixingzee@gmail.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">如果你有更多想了解的内容，欢迎关注我的个人公众号：<b>生信技术</b> <br> <img src="https://s4.ax1x.com/2021/12/29/TcEUvq.gif"> <br> <br></div><timing></timing></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">面向对象编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">一、什么是面向对象编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Python%E7%B1%BB%E7%9A%84%E5%AE%9A%E4%B9%89%E4%B8%8E%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text">二、Python类的定义与实例化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.2.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">1.3.</span> <span class="toc-text">三、实例属性的定义</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-2"><span class="toc-number">1.3.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.4.</span> <span class="toc-text">四、实例属性的初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-3"><span class="toc-number">1.4.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%B1%BB%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.</span> <span class="toc-text">五、类属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-4"><span class="toc-number">1.5.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E7%B1%BB%E5%B1%9E%E6%80%A7%E5%92%8C%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">1.6.</span> <span class="toc-text">六、类属性和实例属性的优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-5"><span class="toc-number">1.6.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%AE%BF%E9%97%AE%E9%99%90%E5%88%B6"><span class="toc-number">1.7.</span> <span class="toc-text">七、访问限制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-6"><span class="toc-number">1.7.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BE%8B%E6%96%B9%E6%B3%95"><span class="toc-number">1.8.</span> <span class="toc-text">八、定义实例方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-7"><span class="toc-number">1.8.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%AE%9A%E4%B9%89%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">1.9.</span> <span class="toc-text">九、定义类方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-8"><span class="toc-number">1.9.1.</span> <span class="toc-text">任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E3%80%81%E5%A4%9A%E6%80%81"><span class="toc-number">2.</span> <span class="toc-text">Python进阶教程笔记（二）类的继承、多态</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%A7%E6%89%BF"><span class="toc-number">2.1.</span> <span class="toc-text">一、什么是继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%A7%E6%89%BF%E7%9A%84%E4%BC%98%E7%82%B9"><span class="toc-number">2.2.</span> <span class="toc-text">二、继承的优点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%BB%A7%E6%89%BF%E7%B1%BB"><span class="toc-number">2.3.</span> <span class="toc-text">三、继承类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-9"><span class="toc-number">2.3.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%88%A4%E6%96%AD%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.4.</span> <span class="toc-text">四、判断类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-10"><span class="toc-number">2.4.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E5%A4%9A%E6%80%81"><span class="toc-number">2.5.</span> <span class="toc-text">五、多态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E4%B8%AD%E7%9A%84%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-number">2.5.1.</span> <span class="toc-text">Python中的多重继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-11"><span class="toc-number">2.5.2.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E8%8E%B7%E5%8F%96%E5%AF%B9%E8%B1%A1%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.</span> <span class="toc-text">六、获取对象信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-12"><span class="toc-number">2.6.1.</span> <span class="toc-text">任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%89%EF%BC%89%E7%B1%BB%E7%9A%84%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">Python进阶教程笔记（三）类的特殊方法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E7%89%B9%E6%AE%8A%E6%96%B9%E6%B3%95"><span class="toc-number">3.1.</span> <span class="toc-text">一、什么是特殊方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%B1%BB%E7%9A%84-str-%E5%92%8C-repr-%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">二、类的__str__ 和 __repr__方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-13"><span class="toc-number">3.2.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E7%B1%BB%E7%9A%84-len-%E6%96%B9%E6%B3%95"><span class="toc-number">3.3.</span> <span class="toc-text">三、类的__len__方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-14"><span class="toc-number">3.3.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E7%B1%BB%E7%9A%84%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-number">3.4.</span> <span class="toc-text">四、类的数学运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-15"><span class="toc-number">3.4.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E7%B1%BB%E7%9A%84-slots-%E6%96%B9%E6%B3%95"><span class="toc-number">3.5.</span> <span class="toc-text">五、类的__slots__方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-16"><span class="toc-number">3.5.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E7%B1%BB%E7%9A%84-call-%E6%96%B9%E6%B3%95"><span class="toc-number">3.6.</span> <span class="toc-text">六、类的__call__方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-17"><span class="toc-number">3.6.1.</span> <span class="toc-text">任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%9B%9B%EF%BC%89%E6%A8%A1%E5%9D%97%E5%92%8C%E5%8C%85"><span class="toc-number">4.</span> <span class="toc-text">Python进阶教程笔记（四）模块和包</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%AE%9A%E4%B9%89%E6%A8%A1%E5%9D%97"><span class="toc-number">4.1.</span> <span class="toc-text">一、定义模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-18"><span class="toc-number">4.1.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97"><span class="toc-number">4.2.</span> <span class="toc-text">二、导入模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-19"><span class="toc-number">4.2.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E7%9A%84%E8%B7%AF%E5%BE%84"><span class="toc-number">4.3.</span> <span class="toc-text">三、模块导入的路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E5%AE%89%E8%A3%85%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A8%A1%E5%9D%97%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">4.4.</span> <span class="toc-text">四、安装第三方模块的方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%BB%E5%86%99%E6%96%87%E4%BB%B6"><span class="toc-number">5.</span> <span class="toc-text">Python进阶教程笔记（五）读写文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%90%91Python%E7%A8%8B%E5%BA%8F%E8%BE%93%E5%85%A5%E5%86%85%E5%AE%B9"><span class="toc-number">5.1.</span> <span class="toc-text">一、向Python程序输入内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-20"><span class="toc-number">5.1.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%89%93%E5%BC%80%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6"><span class="toc-number">5.2.</span> <span class="toc-text">二、打开文本文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%89%93%E5%BC%80%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6"><span class="toc-number">5.3.</span> <span class="toc-text">三、打开二进制文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">5.4.</span> <span class="toc-text">四、读取文件内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E8%8B%A5%E5%B9%B2%E5%AD%97%E7%AC%A6"><span class="toc-number">5.4.1.</span> <span class="toc-text">读取若干字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E4%B8%80%E8%A1%8C"><span class="toc-number">5.4.2.</span> <span class="toc-text">读取一行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%A4%9A%E8%A1%8C"><span class="toc-number">5.4.3.</span> <span class="toc-text">读取多行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%8A%8A%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">5.5.</span> <span class="toc-text">五、把字符串写入文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E8%8B%A5%E5%B9%B2%E5%AD%97%E7%AC%A6"><span class="toc-number">5.5.1.</span> <span class="toc-text">写入若干字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E8%8B%A5%E5%B9%B2%E8%A1%8C"><span class="toc-number">5.5.2.</span> <span class="toc-text">写入若干行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-21"><span class="toc-number">5.5.3.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E5%BE%80%E6%96%87%E4%BB%B6%E8%BF%BD%E5%8A%A0%E5%86%85%E5%AE%B9"><span class="toc-number">5.6.</span> <span class="toc-text">六、往文件追加内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-22"><span class="toc-number">5.6.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E6%AD%A3%E7%A1%AE%E5%85%B3%E9%97%AD%E6%96%87%E4%BB%B6"><span class="toc-number">5.7.</span> <span class="toc-text">七、正确关闭文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">Python进阶教程笔记（六）网络编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%A5%97%E6%8E%A5%E5%AD%97Socket%E4%B8%8E%E5%A5%97%E6%8E%A5%E5%AD%97%E7%BC%96%E7%A8%8B"><span class="toc-number">6.1.</span> <span class="toc-text">一、套接字Socket与套接字编程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-23"><span class="toc-number">6.1.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%87%AA%E5%B8%A6%E7%9A%84HTTP%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">6.2.</span> <span class="toc-text">二、自带的HTTP服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-24"><span class="toc-number">6.2.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8F%91%E9%80%81HTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">6.3.</span> <span class="toc-text">三、发送HTTP请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81requests%E5%BA%93"><span class="toc-number">6.4.</span> <span class="toc-text">四、requests库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81HTTP%E5%93%8D%E5%BA%94%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">6.5.</span> <span class="toc-text">五、HTTP响应的内容</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Python%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">7.</span> <span class="toc-text">Python进阶教程笔记（七）函数式编程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">7.1.</span> <span class="toc-text">一、什么是函数式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Python%E7%9A%84%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B"><span class="toc-number">7.2.</span> <span class="toc-text">二、Python的函数式编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%8A%8A%E5%87%BD%E6%95%B0%E4%BD%9C%E4%B8%BA%E5%8F%82%E6%95%B0"><span class="toc-number">7.3.</span> <span class="toc-text">三、把函数作为参数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-25"><span class="toc-number">7.3.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81map-%E5%87%BD%E6%95%B0"><span class="toc-number">7.4.</span> <span class="toc-text">四、map()函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-26"><span class="toc-number">7.4.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81reduce-%E5%87%BD%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text">五、reduce()函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-27"><span class="toc-number">7.5.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81filter-%E5%87%BD%E6%95%B0"><span class="toc-number">7.6.</span> <span class="toc-text">六、filter()函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-28"><span class="toc-number">7.6.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8E%92%E5%BA%8F%E5%87%BD%E6%95%B0"><span class="toc-number">7.7.</span> <span class="toc-text">七、自定义排序函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-29"><span class="toc-number">7.7.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E8%BF%94%E5%9B%9E%E5%87%BD%E6%95%B0"><span class="toc-number">7.8.</span> <span class="toc-text">八、返回函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-30"><span class="toc-number">7.8.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E9%97%AD%E5%8C%85"><span class="toc-number">7.9.</span> <span class="toc-text">九、闭包</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-31"><span class="toc-number">7.9.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E5%8C%BF%E5%90%8D%E5%87%BD%E6%95%B0"><span class="toc-number">7.10.</span> <span class="toc-text">十、匿名函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-32"><span class="toc-number">7.10.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99%E6%97%A0%E5%8F%82%E6%95%B0%E7%9A%84decorator"><span class="toc-number">7.11.</span> <span class="toc-text">十一、编写无参数的decorator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-33"><span class="toc-number">7.11.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99%E6%9C%89%E5%8F%82%E6%95%B0%E7%9A%84decorator"><span class="toc-number">7.12.</span> <span class="toc-text">十二、编写有参数的decorator</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-34"><span class="toc-number">7.12.1.</span> <span class="toc-text">任务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E5%81%8F%E5%87%BD%E6%95%B0"><span class="toc-number">7.13.</span> <span class="toc-text">十三、偏函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1-35"><span class="toc-number">7.13.1.</span> <span class="toc-text">任务</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/20/python_advanced/" title="Python 进阶笔记"><img src="https://s1.ax1x.com/2022/05/26/XZa1kq.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Python 进阶笔记"/></a><div class="content"><a class="title" href="/2022/05/20/python_advanced/" title="Python 进阶笔记">Python 进阶笔记</a><time datetime="2022-05-20T14:19:09.000Z" title="发表于 2022-05-20 22:19:09">2022-05-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/07/docker_advanced/" title="Docker 进阶篇"><img src="https://s1.ax1x.com/2022/04/17/LN4GtO.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 进阶篇"/></a><div class="content"><a class="title" href="/2022/04/07/docker_advanced/" title="Docker 进阶篇">Docker 进阶篇</a><time datetime="2022-04-07T14:19:09.000Z" title="发表于 2022-04-07 22:19:09">2022-04-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/06/docker_base/" title="Docker 基础篇"><img src="https://s1.ax1x.com/2022/04/17/LN48AK.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Docker 基础篇"/></a><div class="content"><a class="title" href="/2022/04/06/docker_base/" title="Docker 基础篇">Docker 基础篇</a><time datetime="2022-04-06T14:19:09.000Z" title="发表于 2022-04-06 22:19:09">2022-04-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/02/JavaScript/" title="JavaScript"><img src="https://s1.ax1x.com/2022/04/11/LZizLV.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaScript"/></a><div class="content"><a class="title" href="/2022/04/02/JavaScript/" title="JavaScript">JavaScript</a><time datetime="2022-04-02T14:19:09.000Z" title="发表于 2022-04-02 22:19:09">2022-04-02</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/01/html_css/" title="HTML &amp; CSS"><img src="https://s1.ax1x.com/2022/04/11/LZixs0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTML &amp; CSS"/></a><div class="content"><a class="title" href="/2022/04/01/html_css/" title="HTML &amp; CSS">HTML &amp; CSS</a><time datetime="2022-04-01T14:19:09.000Z" title="发表于 2022-04-01 22:19:09">2022-04-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022&nbsp;<i style="color:#FF6A6A;animation: announ_animation 0.8s linear infinite;"class="fas fa-heart"></i> By 李星泽</div></div><div class="container" id="jsi-flying-fish-container"><script src="/js/fish.js"></script></div><style>   @media only screen and (max-width: 767px){
   #sidebar_search_box input[type=text]{width:calc(100% - 24px)}
}</style></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    let initData = {
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    }

    if (true) { 
      initData.requiredFields= ('nick,mail'.split(','))
    }
    
    if (false) {
      const otherData = false
      initData = Object.assign(initData, otherData)
    }
    
    const valine = new Valine(initData)
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/js/jquery.min.js"></script><script src="/js/fish.js"></script><script src="/js/timing.js"></script><script async src="https://cdn.jsdelivr.net/npm/aplayer"></script><script async src="https://cdn.jsdelivr.net/npm/meting/dist/Meting.min.js"></script><div class="aplayer no-destroy" data-id="000PeZCQ1i4XVs" data-server="tencent" data-type="artist" data-fixed="true" data-mini="true" data-listFolded="false" data-order="random" data-preload="none" data-autoplay="flase data-lrctype="3" " muted></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-nest.min.js"></script><script>(function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/f84bbafb.js","daovoice")
</script><script>var isChatBtn = false
daovoice('init', {
  app_id: 'f84bbafb',},{
  launcher: { 
     disableLauncherIcon: isChatBtn // 悬浮 ICON 是否显示
  },
});
daovoice('update');

if (isChatBtn) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      daovoice('show')
    });
  }
  chatBtnFn()
} else {
  if (false) {
    function chatBtnHide () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: true // 悬浮 ICON 是否显示
        },
      });
    }
    function chatBtnShow () {
      daovoice('update', {},{
        launcher: { 
        disableLauncherIcon: false // 悬浮 ICON 是否显示
        },
      });
    }
  }
}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = [
  'title',
  '#config_change',
  '#body-wrap',
  '#rightside-config-hide',
  '#rightside-config-show',
  '.js-pjax'
]

if (false) {
  pjaxSelectors.unshift('meta[property="og:image"]', 'meta[property="og:title"]', 'meta[property="og:url"]')
}

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  if (typeof gtag === 'function') {
    gtag('config', 'G-QRG4NL4207', {'page_path': window.location.pathname});
  }

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // Analytics
  if (false) {
    MtaH5.pgv()
  }

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})


document.addEventListener('pjax:send', function () {
  typeof preloader === 'object' && preloader.initLoading()
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})</script><script>(function(){
  const bp = document.createElement('script');
  const curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  bp.dataset.pjax = ''
  const s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})()</script></div></body></html>